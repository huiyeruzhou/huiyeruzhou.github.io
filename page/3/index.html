<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"huiyeruzhou.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="辉夜的博客">
<meta property="og:url" content="http://huiyeruzhou.github.io/page/3/index.html">
<meta property="og:site_name" content="辉夜的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="辉夜">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://huiyeruzhou.github.io/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>辉夜的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">辉夜的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">繁花似锦，辉夜如昼</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>Links</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://huiyeruzhou.github.io/2022/07/26/%E5%AE%89%E5%8D%93%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="辉夜">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="辉夜的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/26/%E5%AE%89%E5%8D%93%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6/" class="post-title-link" itemprop="url">安卓四大组件</a>
        </h2>

        <div class="post-meta">
          
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-26 16:14:58" itemprop="dateCreated datePublished" datetime="2022-07-26T16:14:58+08:00">2022-07-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-08 22:40:39" itemprop="dateModified" datetime="2023-03-08T22:40:39+08:00">2023-03-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h2><h3 id="activity的使用"><a href="#activity的使用" class="headerlink" title="activity的使用"></a>activity的使用</h3><ol>
<li>在Android Menifest文件中注册</li>
<li>在xml文件中设定layout</li>
<li>在java文件中绑定activity</li>
</ol>
<p>GridView + Adaptor, GridView + Adaptor, ViewPager + Adaptor</p>
<h3 id="activity生命周期"><a href="#activity生命周期" class="headerlink" title="activity生命周期"></a>activity生命周期</h3><ol>
<li>onCreate<br>程序创建，进行文件的绑定</li>
<li>onStart<br>程序不可见，用户不可交互，进行一些</li>
<li>onResume<br>程序可见，用户可以交互</li>
<li>onPause<br>程序部分不可见，（比如被弹窗遮挡），在这里是最后一个比较靠谱的数据保存点（Android 5.0-）。<br>之后也可以在onStop中进行数据保存<br>如果之后恢复可见，会调用onResume</li>
<li>onStop<br>程序被完全遮挡，如果恢复，经由onRestart回到onStart</li>
<li>onDestroy<br>程序被销毁，注意，很多场景下可能不会走到这一步，而是在停止之后直接被系统回收</li>
</ol>
<p>配置变化（字体改变，屏幕旋转，键盘显示隐藏…）时的生命周期：先杀死再重建，杀死时在onPause之前调用onSaveInstanceState，<br>恢复时在onStart之后调用onRestoreInstanceState</p>
<p>如果不希望重建activity，可以在android_menifest文件中配置，在配置改变时调用onConfigurationChange，而不销毁。</p>
<blockquote>
<p>案例：接完电话之后，程序crush！</p>
</blockquote>
<ul>
<li><p>解释：页面被回收导致本地变量被清空</p>
</li>
<li><p>解决：添加判空逻辑避免空指针</p>
<ul>
<li>利用两个InstanceState保存和恢复现场！</li>
</ul>
</li>
</ul>
<h3 id="activity启动模式"><a href="#activity启动模式" class="headerlink" title="activity启动模式"></a>activity启动模式</h3><p>对于每个activity，都可以在android：launchMode中配置启动模式来达到消除重复activity的效果</p>
<ol>
<li>standard（默认）<br>每次启动页面都会在页面栈中添加一个新实例</li>
<li>singleTop<br>不允许栈顶有多个相同实例，试图创建新示例时会回调onNewInstance，然后无事发生</li>
<li>singleTask<br>不允许栈内有多个实例，如果试图创建新示例，将弹出页面之上的所有页面，然后回调onNewInstance</li>
<li>singleInstance<br>全局只能有一个实例，应用较少（银行登陆界面，通讯录黄页）</li>
</ol>
<blockquote>
<p>应用：返回首页的小按钮</p>
</blockquote>
<ul>
<li>实现：将主页activity设置为singleTask</li>
</ul>
<h2 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h2><p>安卓设计fragment的初衷是为了解决页面碎片化的问题，不过平时开发中fragment经常用于提高速度（activity之间交互需要进行IPC），<br>以及进行组件的分离（在屏幕的各个区域用不同的fragment承载功能）</p>
<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><ol>
<li>创建布局文件</li>
<li>在java中加载布局文件</li>
<li>在activity中加载fragment<br>3.1 静态绑定-在布局文件中绑定<br>3.2 通过FragmentManager加载</li>
</ol>
<p>一般使用androidx.fragment，而不是android.app.fragment，以确保版本兼容</p>
<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><ol>
<li>onAttach<br> 使用activity资源时可以在此进行获取</li>
<li>onCreateView<br> 常用于初始化</li>
<li>onResume<br> 运行状态</li>
<li>onDestroyView<br> 资源回收</li>
</ol>
<p>此外也可以通过FragmentTranscation.maxLifeCycle设置可到达的最远生命周期</p>
<h3 id="与activity交互"><a href="#与activity交互" class="headerlink" title="与activity交互"></a>与activity交互</h3><p>组件获取</p>
<ul>
<li><code>getActivity.findViewById(R.id.xx)</code></li>
<li>getFragmentManager.findFragmentById()</li>
</ul>
<p>数据传递</p>
<ol>
<li>setArguments(Bundle bundle)</li>
<li>方法调用</li>
<li>viewmodel，handler，broadcast</li>
</ol>
<h2 id="service"><a href="#service" class="headerlink" title="service"></a>service</h2><p>基本用法</p>
<ol>
<li>android_menifest注冊</li>
<li>java中实现类</li>
<li>加载：需要交互用bindService，不需要交互用startService</li>
</ol>
<h3 id="生命周期-1"><a href="#生命周期-1" class="headerlink" title="生命周期"></a>生命周期</h3><p>start， bind， destroy<br>&#x2F;&#x2F;TODO</p>
<h3 id="通信方式"><a href="#通信方式" class="headerlink" title="通信方式"></a>通信方式</h3><ol>
<li>定义Binder子类，实现getService方法，返回Service对象</li>
<li>实现Service类onBind方法，返回Binder对象</li>
<li>实例化ServiceConnection对象<br>&#x2F;&#x2F;TODO</li>
</ol>
<h2 id="broadcast"><a href="#broadcast" class="headerlink" title="broadcast"></a>broadcast</h2><p>静态广播：使用receiver，在java中实现BroadcastReceiver，用onRecieve接收，用Context.sendBroadcast发送<br>动态广播：</p>
<p>常用广播：网络&#x2F;电量变化，屏幕点亮&#x2F;熄灭，安装卸载升级软件</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://huiyeruzhou.github.io/2022/07/06/%E7%B2%BE%E7%A5%9E%E5%88%86%E6%9E%90%E7%AC%94%E8%AE%B0-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="辉夜">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="辉夜的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/06/%E7%B2%BE%E7%A5%9E%E5%88%86%E6%9E%90%E7%AC%94%E8%AE%B0-2/" class="post-title-link" itemprop="url">精神分析笔记(2)</a>
        </h2>

        <div class="post-meta">
          
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-06 23:58:43" itemprop="dateCreated datePublished" datetime="2022-07-06T23:58:43+08:00">2022-07-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-08 22:41:39" itemprop="dateModified" datetime="2023-03-08T22:41:39+08:00">2023-03-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%BF%83%E7%90%86%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">心理学</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>接下来的几讲介绍修通，修通是精神分析疗法中的一个重要概念。同之前的课程一样，我们还是从大背景讲起。</p>
<h2 id="精神分析治疗的理论路线"><a href="#精神分析治疗的理论路线" class="headerlink" title="精神分析治疗的理论路线"></a>精神分析治疗的理论路线</h2><p>精神分析疗法的最终目的应该是让病人产生持久性的改变。弗洛伊德的精神分析讨论的是：压抑导致心理冲突。心理冲突是神经症的心理机制，那么就来解决冲突。心理冲突最尖锐的时候是三到五岁，神经症对应心理发展阶段3~5岁，此时的压抑最为强烈，主要是对性的压抑，这就是弗洛伊德的理论。</p>
<p>客体关系理论指出，三岁以前两岁以内的时期，孩子不具有自己反抗自己、自己管理自己的能力，压抑比较弱。两岁以内，不完全受本能的推动，而很可能是受人际关系这个动力的推动。<br>弗洛伊德注意到本能似乎是很正确的，但那时很少有人注意到人际关系的重要。客体关系理论强调孩子除了吃的本能之外，还对养育者有着建立关系的需要，这种需要直接推动心理的发展。</p>
<ul>
<li>实验：布猴与铁猴</li>
<li>小猴依偎在布猴妈妈身边蹭， 并不理会铁猴的奶水。</li>
</ul>
<p>人和妈妈建立感情的需求，推动人心理的形成，这就是重要的依恋理论。4~6个月开始，孩子就能区分妈妈和陌生人。而四个月之前的孩子有没有人际交往作为生活动力的可能呢？孩子被抱起来之后会转头做吸吮动作，这是否是纯粹的条件反射呢？</p>
<ul>
<li>实验：妈妈在喂奶之后给孩子做鬼脸，从出生之后开始每天重复</li>
<li>到9~12天，孩子一看看到妈妈看他，没等妈妈做鬼脸，孩子先做鬼脸</li>
</ul>
<p>可见，这个实验一下子拜托了本能决定论，人为了和妈妈交流，天然的有建立亲情的需要和动力。到四个月之后，安全、情感交流、亲密感的需要更明显的体现了出来。<br>在两岁之前，孩子都有对人际关系的需要，如果此时没有得到母爱，那么孩子的发展就会受到影响。四个月时，孩子面对陌生人的表现有以下几种：</p>
<ul>
<li>眼睛追踪陌生人，露出微笑</li>
<li>眼睛追踪陌生人，面无表情</li>
<li>眼睛并不转动，毫无反应</li>
</ul>
<p>这三种反应出依次降低的心理功能，因为孩子的反应就体现出妈妈的养育方式。这又会进一步影响孩子两岁以后各种心理功能的发展。</p>
<p>这就是客体关系理论的基本理念：两岁以内的母爱缺乏导致心理功能的缺损。可以说，弗洛伊德的学说是压抑的学说，客体关系理论是功能缺损的学说。<br>心理功能缺损有许多表现，最终都成为人格障碍。这都是因为两岁关系母婴关系出了问题。</p>
<p>弗洛伊德的学说就像是种子的概念，客体关系理论则像是土壤的学说，一个是本能决定论的角度，一个是环境（母婴关系）的学说。这两个学说同时正确，相互补充。我们现在做精神分析必须把两套理论结合起来才是完整的，全面的。</p>
<h3 id="精神分析治疗的工作"><a href="#精神分析治疗的工作" class="headerlink" title="精神分析治疗的工作"></a>精神分析治疗的工作</h3><p><code>把潜意识意识化</code>，这就是经典精神分析（弗洛伊德）的任务。而现代精神分析需要做的事还有<code>修补人格的功能缺损</code>。</p>
<ul>
<li>比喻：精神分析的治疗与修自行车<br> 先补气，再休整，再换零件。支持疗法、人格重整</li>
</ul>
<p>精神分析有这样那样的方法，甚至于不同流派也有各种各样的方法，不过最终最重要的是心理咨询师如何<strong>组装内心的知识结构</strong>，并且<strong>灵活的将其运用于治疗中</strong>。</p>
<h3 id="精神分析的技术路线"><a href="#精神分析的技术路线" class="headerlink" title="精神分析的技术路线"></a>精神分析的技术路线</h3><p>潜意识的催眠术：提出歇斯底里的机制，找到了<code>把潜意识意识化</code><br>自由联想：扩大适应症，疗效更持久。<br>梦的分析：<code>通过梦理解与解释潜意识</code><br>会谈-对峙、澄清、解释、修通 ：稳定而持久的效果</p>
<p>从经典精神分析挖创伤解决症结到修补心理功能的现代精神分析，心理治疗从治疗导向逐渐转变为发展导向。<strong>发展是心理治疗的最终目标</strong>（这句话并不容易真正做到）</p>
<ul>
<li>Tip：修通的地位<br>在会谈成为主要治疗技术时的一个重要手段。</li>
</ul>
<h3 id="治疗关系的发展"><a href="#治疗关系的发展" class="headerlink" title="治疗关系的发展"></a>治疗关系的发展</h3><p>治疗师作为：屏幕、解释者、容器、内化客体</p>
<h3 id="精神分析治疗手段"><a href="#精神分析治疗手段" class="headerlink" title="精神分析治疗手段"></a>精神分析治疗手段</h3><p>建立工作联盟，分析处理移情和阻抗（处理治疗关系），自由联想变形使用（倾听、沉默、打断），偶尔使用梦的分析，更多的则是理解、解释、？？、修通</p>
<p>我们对病人施加影响，根本上决定于病人。但治疗师也要对病人的心理施加影响，在施加影响的时候，精神分析又有何独到之处呢？<br>催眠、暗示、情感宣泄，这都属于非特异性的方法。而自由联想、梦的分析、语言干预中的对峙澄清解释修通则带有特异性。<br>人本主义等也用对峙澄清，而精神分析式的解释由于涉及到阻抗的处理，是精神分析干预中最独特的，也是精神分析干预中最重要的手段。</p>
<h2 id="理解与解释"><a href="#理解与解释" class="headerlink" title="理解与解释"></a>理解与解释</h2><h3 id="什么是理解与解释"><a href="#什么是理解与解释" class="headerlink" title="什么是理解与解释"></a>什么是理解与解释</h3><p>理解就是理解症状的含义，即<strong>症状和心理需要之间的关系</strong></p>
<ul>
<li>案例：失女的父亲<br>地震时，教学楼倒塌，女儿遇难。父亲拿着手机，不吃不睡，不开口。</li>
</ul>
<p>解释：</p>
<ul>
<li>应激反应，急性期的情感休克，麻木 —— 这是理解与解释吗？</li>
</ul>
<p>说明因果关系不是理解：这是站在旁观者的角度进行的理论上的因果阐释，而没有<strong>共情</strong></p>
<ul>
<li>你很<em>愤怒</em>，联系别的家长追查，想上诉，这是因为你<em>心疼</em>女儿。</li>
</ul>
<p>说到这里，闭上的双眼留出泪水。</p>
<ul>
<li>追查上诉，可能得到赔款，但你真正想要的是<strong>给女儿一个交代</strong></li>
</ul>
<p>说到这里，激动的来握手。这时候就可以建立治疗关系了。</p>
<p>可见，对“心疼”的<em>共情</em>是不够的，没有真正表达出他的愿望，<strong>理解他的心理需要</strong>。</p>
<ul>
<li>后续，引着他的动力解决当前的问题：先吃饭看病，做父亲的自己活得好才能给女儿一个交代等等。。。</li>
</ul>
<p>解释就意味着让<strong>潜意识的内容</strong>进入意识，或者说让<strong>精神创伤的原因</strong>进入到意识。透过谈话帮助病人自己也没有意识到的内容进入病人和医生的意识，这样的一个工作就是揭示。解释属于语言干预的范畴。</p>
<p>理解与解释，经常是阐述一些因果关系，弗洛伊德的潜意识决定论会解释精神症与潜意识的关系，揭示内在的需要和动机。许多精神症都是通过象征化的手段来表达心中的欲望，如果通过直接的方式满足了欲望，这个象征化的手段就不需要了。</p>
<ul>
<li><p>例：让男生帮自己拧水瓶盖，间接的表达欲望。</p>
</li>
<li><p>tip：神经症用变通、拐弯的方式表达了自己心理的欲望，而不能拐弯也无法表达的欲望的就成为人格障碍。</p>
</li>
</ul>
<h3 id="理解的功能与形式"><a href="#理解的功能与形式" class="headerlink" title="理解的功能与形式"></a>理解的功能与形式</h3><ol>
<li>与以往的经验保持一致，获得<strong>一致性</strong>的感受，是一种理解。</li>
</ol>
<p>把当前的认知与过往的经验联系起来，建立逻辑联系，这就是理解的形式之一（普通心理学）。一旦理解了，就获得前后一致的内在感受，一旦不理解，就出现经验和认知的矛盾，无法获得一致性的内在感受。<br>比如遇到违背常识的事情，很希望获得背后的原理解释，要不然就感觉很疑惑。</p>
<ol start="2">
<li>完成未完成的事情完成，这也是一种理解</li>
</ol>
<ul>
<li>例：没看完的鬼故事<br>  只有看完了才能获得心理上的一致感！</li>
</ul>
<ol start="3">
<li>把两个事情联系起来获得<strong>整体感</strong>，也是一种理解</li>
</ol>
<p>比如常见的谐音的“寓意”，常见的“兆头”，把自然现象和事物与平安、美好等期盼联系起来。首先给自己一个解释：吃了苹果可以得到好兆头，然后再去削苹果。两个无关的事物通过心理上的理解连接在一起，从而获得了一个整体感，这个整体的两个部分具有心里意义上的联系：吃苹果表达平安。</p>
<h3 id="理解的心理机制"><a href="#理解的心理机制" class="headerlink" title="理解的心理机制"></a>理解的心理机制</h3><p>借着这种连接，心里的愿望也得以实现。这种连接事实上是任意的。</p>
<ul>
<li>例：“预言梦”<br>做了一个梦，梦见一个人推铅球。二十年后看到一个人推铅球，说“我的梦有预言作用”</li>
</ul>
<p>不管“预言”在多久之后实现，都可以在心理上建立联系。梦的记忆和推铅球的认知在当事人的感受中联系起来，这就说出一句话“我的梦具有预言作用”。两个无关的事情一链接，就得到了新的东西。而这东西背后表达的情感是什么呢——获得自主感、自信心、特殊感。</p>
<p>链接的是认知的是记忆，推动链接的是背后的心理需要，让人<em>宁愿</em>把这两个事情做链接。</p>
<ul>
<li>例：孩子看世界<br>太阳升起，因为我起床。太阳落下，因为我睡觉<br>妈妈高兴，因为我乖。妈妈生气，因为我不乖<br>妈妈去世了？ 因为我把妈妈气死了<br>妈妈离开了？ 因为我把妈妈气走了</li>
<li>例：养猫不能留小猫<br>人们说：小猫把老猫气走了。人们大多真的这么认为。<br>其实是老猫宁愿离开家，把家留给小猫，老猫感情上还是想念女儿的，只是宁可离开这个家</li>
</ul>
<p>这也是一种心理意义上的理解，所以有亲人去世的时候，每个活着的人都会感到内疚，检阅自己的过错，恨意消失，想着那个人的好，变成自责。这其实都是心理内部加工过的东西，通过把无关的事情建立联系，借以表达内在的心理情感和心理需要。<br>理解的思维活动，和潜意识的愿望与需要的关系就是这样。我们必须说清楚这个阶段，才能理解病人为何存在着非理性的认知观念。</p>
<h3 id="理解的意义"><a href="#理解的意义" class="headerlink" title="理解的意义"></a>理解的意义</h3><p>非理性的认知观念重点在于<strong>非理性</strong>，重点并非他到底想的是<em>怎样的怀念头</em>，而是他<em>为什么</em>宁愿想坏的念头。认知疗法无法解决，只有精神分析才能回答这个问题：出于内在的需要。</p>
<ul>
<li>例：走不出的失恋<br>充满理想化的回忆，温习爱的痛苦，这才能保持自我的同一性，因此宁愿那么想。</li>
</ul>
<p>“理解”的心理机制可以帮助我们理解一些临床现象。</p>
<p>其次，理解还可以帮助我们在病人心理内部建立新的连接，表达原来无法表达的情感与愿望。<br>我们经常能够在悲剧作品中看到这样的表达，比如传统中国悲剧中总是有一个浪漫式的结尾，通过一种纯粹心理上的理解来获得故事的完整性，并且表达我们内心对于美好故事的愿望。</p>
<p>每个人的心中都会有未完成的故事情节，如同鲁迅写的《风筝》故事，（这里老师记错了结局）,鲁迅并没有释然，而是因为弟弟不冷不热的回应更深刻的感受到了未完成事件的痛苦。</p>
<p>对于未完成事件，如果能找到从前的那个情景，可以完成。如果不能找到，只能通过自己的想象去完成。</p>
<ul>
<li>例：交通事故之后的小伙<br>汽车时刹车不及下坡时撞车，女友惨死。<br>治疗过程中，要帮助他完成这个恋爱故事</li>
</ul>
<p>未完成的事件会导致心理发展的停滞。</p>
<ul>
<li>例：地震中的灾民<br>地震中一个尸体头滚落，卫生局长用砖头把头和尸体接起来，久久难以忘怀。</li>
</ul>
<p>要不要继续讲地震的故事呢？要的，如果不讲，那种惨状就一直停留在头脑里，停滞不前。这个时候就需要我们在内心帮助他完成这个故事。想象家人看到尸体的悲伤，想象家人对好心人的举动，想象你的回应。<br>慢慢的，回忆的内容从血肉模糊的变成家里人，最后淡化，没有了。<br>通过整体性的连接、理解之后，能够表达更多的情感，在心理治疗上具有积极的作用。人看到灾后的一系列事情，时间上进行了动态的发展。<br>在讲地震的这个完整故事的过程中，我们可能从“人的生命真脆弱”，来到看到救灾时的“人类的勇气与善良值得歌颂”，这种情况下，人的心理因为新的解释得到了发展。</p>
<ul>
<li>例：忘不掉的初恋<br>解释：人们总是以为第一次的体验就是正确的，就好比第一次爱人敲了一个窗户，其他人敲了另外的窗户，你就以为那些都不是爱人<br>问题：我只想等着那一类人来敲我的窗<br>解释2：爱人敲了一扇窗你以为是爱情，爱人敲了另一扇窗，你却不去听了<br>问题：没人来敲窗（守株待兔式的爱）<br>解释3：我们不再被动的等待一个爱人，而是主动的创造一个爱人。<br>问题：没人来敲窗总是感觉很寂寞？<br>解释4：主动走出去，去敲别人家的窗</li>
</ul>
<p>这是很好的例子！不同的解释要尽量的贴近内在的想法，建立和他内心的联系，才能一步步的把他带出来，<strong>用贴近内心的解释来推动行为</strong>。通过这种解释，内心多出了新的想法，以新的视角推动人去行动，改变了他行为的方式。</p>
<p>这就是对理解是什么的基本的认识。</p>
<h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><p>治疗师先对自己进行理解，然后<em>将心比心</em>的去理解病人，就叫做对病人的理解。看到别人流眼泪勾起了自己流眼泪时的感受，<em>投射</em>给病人，就是理解（认同性的投射）。<br>理解了而不表达，只是理解。<strong>把理解说给病人听，就是解释</strong>。将心比心地用自我理解理解病人，又把对病人的理解说给病人听，这样的临床操作就叫解释。解释的前提和基础就是理解，也就是理解对方的<strong>动机、需要、行动背后的心理含义</strong><br>病人借助我们的解释，最终不是要理解我们的说法，而是要<strong>加深对自我的理解</strong>。通过自我理解，病人内心的不一致、未完成得以解决，内心的愿望得以表达，也丰富了他内心的想法。自我理解整理散乱的记忆，接续未完成的事件，可以修补心理功能的缺损，让心理更有整体性，更符合现实发展的逻辑。丰富心理功能是解释的客观效果，而达成病人的愿望是解释的主观动力：借着自我理解，病人表达了自己压抑的东西——把潜意识的东西意识化。<br>自由联想回忆起内在的感受，而借助医生的解释，潜意识的愿望能够在意识层面得以觉察和表达，这是解释最重要的功能。<em><strong>精神分析的解释是精神分析治疗的眼珠子</strong></em>。移情和阻抗的处理都需要理解。</p>
<p>人总是希望“解释世界”，要赋予事物意义，要完成未完成的事件（例：没想通的压轴题）。对外界的认知和观念要想成为我们相信的内容，即加入了情感、信念的坚定认同，是需要有一个过程的。这句话为修通埋下伏笔。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://huiyeruzhou.github.io/2022/07/04/README/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="辉夜">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="辉夜的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/04/README/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
          
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-04 11:11:05" itemprop="dateCreated datePublished" datetime="2022-07-04T11:11:05+08:00">2022-07-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-28 20:37:25" itemprop="dateModified" datetime="2022-05-28T20:37:25+08:00">2022-05-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="grpc-Benchmarks"><a href="#grpc-Benchmarks" class="headerlink" title="grpc Benchmarks"></a>grpc Benchmarks</h1><h2 id="QPS-Benchmark"><a href="#QPS-Benchmark" class="headerlink" title="QPS Benchmark"></a>QPS Benchmark</h2><p>The “Queries Per Second Benchmark” allows you to get a quick overview of the throughput and latency characteristics of grpc.</p>
<p>To build the benchmark type</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./gradlew :grpc-benchmarks:installDist</span><br></pre></td></tr></table></figure>

<p>from the grpc-java directory.</p>
<p>You can now find the client and the server executables in <code>benchmarks/build/install/grpc-benchmarks/bin</code>.</p>
<p>The <code>C++</code> counterpart can be found at <a target="_blank" rel="noopener" href="https://github.com/grpc/grpc/tree/master/test/cpp/qps">https://github.com/grpc/grpc/tree/master/test/cpp/qps</a></p>
<p>The <a href="src/jmh/java/io/grpc/benchmarks/netty">netty benchmark</a> directory contains<br>the standard benchmarks used to assess the performance of GRPC. Since these<br>benchmarks run on localhost over loopback the performance of the underlying network is considerably<br>different to real networks and their behavior. To address this issue we recommend the use of<br>a network emulator to make loopback behave more like a real network. To this end the benchmark<br>code looks for a loopback interface with ‘benchmark’ in its name and attempts to use the address<br>bound to that interface when creating the client and server. If it cannot find such an interface it<br>will print a warning and continue with the default localhost address.</p>
<p>To attempt to standardize benchmark behavior across machines we attempt to emulate a 10gbit<br>ethernet interface with a packet delay of 0.1ms.</p>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>On Linux we can use <a target="_blank" rel="noopener" href="https://www.linuxfoundation.org/collaborate/workgroups/networking/netem">netem</a>  to shape the traffic appropriately.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Remove all traffic shaping from loopback</span></span><br><span class="line">sudo tc qdisc del dev lo root</span><br><span class="line"><span class="comment"># Add a priority traffic class to the root of loopback</span></span><br><span class="line">sudo tc qdisc add dev lo root handle 1: prio</span><br><span class="line"><span class="comment"># Add a qdisc under the new class with the appropriate shaping</span></span><br><span class="line">sudo tc qdisc add dev lo parent 1:1 handle 2: netem delay 0.1ms rate 10gbit</span><br><span class="line"><span class="comment"># Add a filter which selects the new qdisc class for traffic to 127.127.127.127</span></span><br><span class="line">sudo tc filter add dev lo parent 1:0 protocol ip prio 1 u32 match ip dst 127.127.127.127 flowid 2:1</span><br><span class="line"><span class="comment"># Create an interface alias call &#x27;lo:benchmark&#x27; that maps 127.127.127.127 to loopback</span></span><br><span class="line">sudo ip addr add dev lo 127.127.127.127/32 label lo:benchmark</span><br></pre></td></tr></table></figure>

<p>to remove this configuration</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo tc qdisc del dev lo root</span><br><span class="line">sudo ip addr del dev lo 127.127.127.127/32 label lo:benchmark</span><br></pre></td></tr></table></figure>

<h3 id="Other-Platforms"><a href="#Other-Platforms" class="headerlink" title="Other Platforms"></a>Other Platforms</h3><p>Contributions are welcome!</p>
<h2 id="Visualizing-the-Latency-Distribution"><a href="#Visualizing-the-Latency-Distribution" class="headerlink" title="Visualizing the Latency Distribution"></a>Visualizing the Latency Distribution</h2><p>The QPS client comes with the option <code>--save_histogram=FILE</code>, if set it serializes the histogram to <code>FILE</code> which can then be used with a plotter to visualize the latency distribution. The histogram is stored in the file format of <a target="_blank" rel="noopener" href="https://hdrhistogram.org/">HdrHistogram</a>. That way it can be plotted very easily using a browser based tool like <a target="_blank" rel="noopener" href="https://hdrhistogram.github.io/HdrHistogram/plotFiles.html">https://hdrhistogram.github.io/HdrHistogram/plotFiles.html</a>. Simply upload the generated file and it will generate a beautiful graph for you. It also allows you to plot two or more histograms on the same surface in order two easily compare latency distributions.</p>
<h2 id="JVM-Options"><a href="#JVM-Options" class="headerlink" title="JVM Options"></a>JVM Options</h2><p>When running a benchmark it’s often useful to adjust some JVM options to improve performance and to gain some insights into what’s happening. Passing JVM options to the QPS server and client is as easy as setting the <code>JAVA_OPTS</code> environment variables. Below are some options that I find very useful:</p>
<ul>
<li><code>-Xms</code> gives a lower bound on the heap to allocate and <code>-Xmx</code> gives an upper bound. If your program uses more than what’s specified in <code>-Xmx</code> the JVM will exit with an <code>OutOfMemoryError</code>. When setting those always set <code>Xms</code> and <code>Xmx</code> to the same value. The reason for this is that the young and old generation are sized according to the total available heap space. So if the total heap gets resized, they will also have to be resized and this will then trigger a full GC.</li>
<li><code>-verbose:gc</code> prints some basic information about garbage collection. It will log to stdout whenever a GC happend and will tell you about the kind of GC, pause time and memory compaction.</li>
<li><code>-XX:+PrintGCDetails</code> prints out very detailed GC and heap usage information before the program terminates.</li>
<li><code>-XX:-HeapDumpOnOutOfMemoryError</code> and <code>-XX:HeapDumpPath=path</code> when you are pushing the JVM hard it sometimes happens that it will crash due to the lack of available heap space. This option will allow you to dive into the details of why it happened. The heap dump can be viewed with e.g. the <a target="_blank" rel="noopener" href="https://eclipse.org/mat/">Eclipse Memory Analyzer</a>.</li>
<li><code>-XX:+PrintCompilation</code> will give you a detailed overview of what gets compiled, when it gets compiled, by which HotSpot compiler it gets compiled and such. It’s a lot of output. I usually just redirect it to file and look at it with <code>less</code> and <code>grep</code>.</li>
<li><code>-XX:+PrintInlining</code> will give you a detailed overview of what gets inlined and why some methods didn’t get inlined. The output is very verbose and like <code>-XX:+PrintCompilation</code> and useful to look at after some major changes or when a drop in performance occurs.</li>
<li>It sometimes happens that a benchmark just doesn’t make any progress, that is no bytes are transferred over the network, there is hardly any CPU utilization and low memory usage but the benchmark is still running. In that case it’s useful to get a thread dump and see what’s going on. HotSpot ships with a tool called <code>jps</code> and <code>jstack</code>. <code>jps</code> tells you the process id of all running JVMs on the machine, which you can then pass to <code>jstack</code> and it will print a thread dump of this JVM.</li>
<li>Taking a heap dump of a running JVM is similarly straightforward. First get the process id with <code>jps</code> and then use <code>jmap</code> to take the heap dump. You will almost always want to run it with <code>-dump:live</code> in order to only dump live objects. If possible, try to size the heap of your JVM (<code>-Xmx</code>) as small as possible in order to also keep the heap dump small. Large heap dumps are very painful and slow to analyze.</li>
</ul>
<h2 id="Profiling"><a href="#Profiling" class="headerlink" title="Profiling"></a>Profiling</h2><p>Newer JVMs come with a built-in profiler called <code>Java Flight Recorder</code>. It’s an excellent profiler and it can be used to start a recording directly on the command line,  from within <code>Java Mission Control</code> or<br>with jcmd.</p>
<p>A good introduction on how it works and how to use it are <a target="_blank" rel="noopener" href="http://hirt.se/blog/?p=364">http://hirt.se/blog/?p=364</a> and <a target="_blank" rel="noopener" href="http://hirt.se/blog/?p=370">http://hirt.se/blog/?p=370</a>.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://huiyeruzhou.github.io/2022/05/11/%E8%8B%B1%E8%AF%AD%E7%A7%91%E6%8A%80%E6%96%87%E7%8C%AE%E9%98%85%E8%AF%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="辉夜">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="辉夜的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/11/%E8%8B%B1%E8%AF%AD%E7%A7%91%E6%8A%80%E6%96%87%E7%8C%AE%E9%98%85%E8%AF%BB/" class="post-title-link" itemprop="url">英语科技文献阅读</a>
        </h2>

        <div class="post-meta">
          
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-05-11 10:44:35 / 修改时间：10:51:52" itemprop="dateCreated datePublished" datetime="2022-05-11T10:44:35+08:00">2022-05-11</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Structure-of-RA"><a href="#Structure-of-RA" class="headerlink" title="Structure of RA"></a>Structure of RA</h2><ul>
<li>Title</li>
<li>Authors &amp; Affiliation(单位)</li>
<li><em>Abstract</em></li>
<li><strong>Introduction</strong></li>
<li><strong>Materials &amp; Methods</strong></li>
<li><strong>Results &amp; Discussion</strong></li>
<li>Conclusion</li>
<li>Acknowledgements(致谢)</li>
<li>Appendix</li>
<li>Reference(引用)</li>
<li>Bibliography(参考)</li>
</ul>
<h2 id="Title"><a href="#Title" class="headerlink" title="Title"></a>Title</h2><h3 id="Type-of-Title"><a href="#Type-of-Title" class="headerlink" title="Type of Title"></a>Type of Title</h3><ul>
<li><p>Declaration 声明性</p>
<p>  整句<strong>话</strong></p>
</li>
<li><p>Descriptive&#x2F;neutral 描述性&#x2F;中性标题</p>
<p>  名<strong>词</strong>短语+定语</p>
</li>
<li><p>Interrogative 疑问句式</p>
<p>  疑问<strong>句</strong></p>
</li>
<li><p>Compound 复合型标题</p>
<p>  由主副两部分构成（冒号或破折号分开）</p>
</li>
</ul>
<h3 id="How-to-read-title"><a href="#How-to-read-title" class="headerlink" title="How to read title"></a>How to read title</h3><p>devide the title into sense group</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Strategies | to re-establish stable granulation | after filamentous outgrowth | : Insignts | from lab-scale</span><br></pre></td></tr></table></figure>

<ul>
<li>名词</li>
<li>动宾短语</li>
<li>介词短语</li>
<li>…</li>
</ul>
<h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><ul>
<li>at the beginning (or the end) of a research article, miniature of a research work.</li>
<li>independent, self-contained, well-structured 独立完整&#x2F;自圆其说&#x2F;结构严谨</li>
<li>Consist of Five Move(话步,语步)<ul>
<li>background 是什么</li>
<li>problem 做了什么 (purpose&#x2F;hypotheses)</li>
<li>method 怎么做的</li>
<li>result 有何结果 (major finding&#x2F;important data)</li>
<li>conclusion 总结展望 (further study&#x2F;future directions)</li>
</ul>
</li>
</ul>
<h3 id="How-to-read-abstract"><a href="#How-to-read-abstract" class="headerlink" title="How to read abstract"></a>How to read abstract</h3><ul>
<li><p>focus on subject + verb</p>
</li>
<li><p>devide the abstract into five moves</p>
</li>
<li><p>focus on clue words:</p>
<ul>
<li>“such”, “recently”,”today” that indicates present time can be found in move 1.</li>
<li>“here”, “this paper” with past tense usually come with move 2 and 3</li>
<li>method will be described with verbs.</li>
<li>“showed”“revealed”“indicated” are used to discribe result and “find” for finding</li>
<li>present and future tenses with subjective mood are used in making conclusion, with words like “could””would”.</li>
</ul>
</li>
</ul>
<h2 id="keywords"><a href="#keywords" class="headerlink" title="keywords"></a>keywords</h2><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><ul>
<li><p>context : explains the rationale for undertaking the study and clearly describes the main purpose of conducing it.</p>
</li>
<li><p>purpose : to <strong>c</strong>reate <strong>a</strong> <strong>r</strong>esearch <strong>s</strong>pace(CARS)</p>
</li>
<li><p>moves</p>
<ol>
<li>Establishing a territory<br>现状描述词</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Increasing interest has grown on ...</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Reviewing previous related research<br> 文献综述词</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Several Studies have ...</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Establishing a niche(壁炉)<br>转折否定词</li>
</ol>
<pre><code>- However/while/but...
- failed to 
- ignored/neglected to
</code></pre>
<ol start="4">
<li>Occupying the niche</li>
</ol>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://huiyeruzhou.github.io/2022/04/21/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="辉夜">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="辉夜的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/21/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/" class="post-title-link" itemprop="url">Android学习笔记（二）</a>
        </h2>

        <div class="post-meta">
          
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-21 14:42:38" itemprop="dateCreated datePublished" datetime="2022-04-21T14:42:38+08:00">2022-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-08 22:40:39" itemprop="dateModified" datetime="2023-03-08T22:40:39+08:00">2023-03-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="在Activity间传递参数"><a href="#在Activity间传递参数" class="headerlink" title="在Activity间传递参数"></a>在Activity间传递参数</h2><p>写了个小脚本解决虚拟机频繁锁死的问题:</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">del</span> C:\Users\huiyeruzhou\.android\*.lock</span><br></pre></td></tr></table></figure>

<p>这下一键开锁了(<br>在Activity间传递参数的方法很简单,在Intnet里把参数压进去就可以了（此时还没有详细讲解什么是Intent）:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">    Intent i = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, TheAty.class);</span><br><span class="line">    i.putExtra(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;qaq!QAQ__&quot;</span>);</span><br><span class="line">    startActivity(i);&#125;</span><br></pre></td></tr></table></figure>

<p>intent传递参数的方式是键值对，值可以传很多类型，包括基本类型、数组、字符串等。<br>接收的方法也很简单：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Intent i =getIntent();</span><br><span class="line">tv = findViewById(R.id.viewview);</span><br><span class="line">tv.setText(i.getStringExtra(<span class="string">&quot;data&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>这里的”data”就是之前数据的名称。通过名称可以找到字符串，并且通过setText方法显示在文本框里。</p>
<h3 id="使用Bundle传递多个参数"><a href="#使用Bundle传递多个参数" class="headerlink" title="使用Bundle传递多个参数"></a>使用Bundle传递多个参数</h3><p>Bundle的使用方法和基本类型是类似的，先新建一个Bundle对象，然后调用对象的<code>put&lt;DataType&gt;</code>方法<br>再调用Intent对象的<code>putExtras</code>方法传递Bundle即可，接收的方法也是类似的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Intent i = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, TheAty.class);</span><br><span class="line">               Bundle b = <span class="keyword">new</span> Bundle();</span><br><span class="line">               b.putString(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;qaq?QAQ&gt;_&lt;&quot;</span>);</span><br><span class="line">               b.putInt(<span class="string">&quot;emm&quot;</span>,<span class="number">611</span>);</span><br><span class="line">               i.putExtras(b);</span><br><span class="line">               startActivity(i);</span><br></pre></td></tr></table></figure>

<p>接收Bundle的数据时，可能会存在某个键无法在Bundle中找到对应值得情况，这种情况下Bundle类提供了<br><code>get&lt;DataType&gt;</code>的重载方法以指定默认值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tv.setText(String.format(<span class="string">&quot;%s,%d,%s&quot;</span>,</span><br><span class="line">                b.getString(<span class="string">&quot;data&quot;</span>),b.getInt(<span class="string">&quot;emm&quot;</span>),</span><br><span class="line">                b.getString(<span class="string">&quot;ne!&quot;</span>,<span class="string">&quot;abab&quot;</span>)));<span class="comment">//&quot;ne!&quot;对应的值不存在，显示为默认值&quot;abab&quot;</span></span><br></pre></td></tr></table></figure>

<p>此外，Bundle也可以直接通过putExtra方法进行传递，这种情况可能适用于有多个Bundle的情况，此时<br>接受时也要使用getBundleExtra方法来进行查找。</p>
<h3 id="传递值对象"><a href="#传递值对象" class="headerlink" title="传递值对象"></a>传递值对象</h3><h2 id="Activity的启动模式"><a href="#Activity的启动模式" class="headerlink" title="Activity的启动模式"></a>Activity的启动模式</h2><p>首先来看标准启动模式，也是默认的启动模式。我们来新建一个项目来演示不同的启动模式。首先为MainActivity添加一个TextView，两个Button<br>新建一个活动，叫做AnotherActivity，复制MainActivity的布局文件</p>
<p>java代码中设置TextView要显示的内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tv.setText(format(<span class="string">&quot;Task ID:%d\nCurrent Instance id:%s&quot;</span>,getTaskId(),<span class="keyword">this</span>.toString()));</span><br></pre></td></tr></table></figure>

<p>Task ID是任务栈id，而当前示例ID则是当前对象的地址，可以用来区分activity的示例。</p>
<p>接下来设置两个按钮，一个启动MainActivity一个启动AnotherActivity，复制上述代码到AnotherActivity.java，注意修改intent中package context为<code>AnotherActivity.this</code>，效果如图</p>
<div align="center">
 <img src="Android学习笔记（二）/2022-04-22-22-35-18.png" width="50%">
</div>

<p>接下来可以点按钮试试，可以观察到TaskId都是一样的，而实例的id是不同的，这就意味着点击按钮会创建新的示例，而且所有的示例都位于一个任务栈中。</p>
<p>在标准的启动模式中，我们启动一个Activity就会压栈一个新的实例，点击返回键就会弹栈。多次点击app的创建示例按钮，再按返回键，可以观察到他们依次被销毁的过程。</p>
<p>可以在AndroidManifest.xml文件中的Activity标签下添加Android:launchMode条目来指定启动模式，如果没有这个条目，则默认为Standard。</p>
<h3 id="SingleTop启动模式"><a href="#SingleTop启动模式" class="headerlink" title="SingleTop启动模式"></a>SingleTop启动模式</h3><p>SingleTop，顾名思义，如果该活动的一个实例位于栈顶，就不能继续创建该活动的新实例。只有当栈顶实例不为该活动时，才能创建该活动的新实例。<br>下面在AndroidManifest.xml文件中配置MainActivity的启动模式为SingleTop.</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> &lt;activity</span><br><span class="line">            android:name=&quot;.MainActivity&quot;</span><br><span class="line">            android:exported=&quot;true&quot;</span><br><span class="line"><span class="addition">+            android:launchMode=&quot;singleTop&quot;&gt;</span></span><br></pre></td></tr></table></figure>

<p>启动程序，首先点击启动A活动按钮，应用没有反应。此时如果点击返回键会直接退出。<br>如果启动程序后先点击启动B活动按钮，再点击启动A活动按钮，可以发现这次成功的创建了A的新实例。这是因为创建了B活动之后，A活动的上一个实例已经不在栈顶，因此可以创建新的实例。</p>
<h3 id="SingleTask模式"><a href="#SingleTask模式" class="headerlink" title="SingleTask模式"></a>SingleTask模式</h3><p>在这种情况下，一个任务栈中只能有一个该任务的实例，如果试图创建新实例，将会<strong>弹出</strong>所有位于该实例上的活动实例。<br>修改AndroidManifest文件，将启动模式修改为<code>singleTask</code>,启动应用程序。<br>点击启动A活动按钮，没有反应。点击启动B活动按钮，再点击启动A活动按钮，可以看到B活动退出，而显示的A活动正是第一个示例，如果此时再点击返回键，应用直接退出，说明所有B活动的示例都因为其位于A活动上方而被弹出了。</p>
<h3 id="SingleInstance模式"><a href="#SingleInstance模式" class="headerlink" title="SingleInstance模式"></a>SingleInstance模式</h3><p>在这种情况下，全局只有该活动的一个实例，第一次创建该活动时会创建一个新的任务栈，并且一个任务栈中只有这一个activity，而其他活动的实例会位于新的任务栈中。这种情况下，试图启动该活动的新实例时，会切换到保存该活动实例的任务栈。其他的任务栈不受影响。</p>
<h3 id="SingleInstancePerTask"><a href="#SingleInstancePerTask" class="headerlink" title="SingleInstancePerTask"></a>SingleInstancePerTask</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://huiyeruzhou.github.io/2022/04/20/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="辉夜">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="辉夜的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/20/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/" class="post-title-link" itemprop="url">Android学习笔记（一）</a>
        </h2>

        <div class="post-meta">
          
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-20 22:12:13" itemprop="dateCreated datePublished" datetime="2022-04-20T22:12:13+08:00">2022-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-08 22:40:39" itemprop="dateModified" datetime="2023-03-08T22:40:39+08:00">2023-03-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="认识Activity"><a href="#认识Activity" class="headerlink" title="认识Activity"></a>认识Activity</h2><p>activity就是一个活动界面，软件通过界面与用户交互。<br>后退键回到上一个activity，home键回到桌面。这两个按键都会影响activity。<br>一个Android项目包含两个最基本的文件：activity_main.xml,MainActivity.java。</p>
<p>activity.xml是主界面的布局文件，修改其中的内容可以设计程序的ui。在设计模式下可以直接拖动组件放到布局中<br>在res&#x2F;value&#x2F;string.xml中可以修改字符串的内容。<br>也可以选中内容按CTRL-B跳转。</p>
<p>程序从onCreate开始执行，activity通过<code>setContentView</code>方法生成视图。由资源文件生成了R.txt中的<code>layout activity_main</code>，<br>这会布局文件.xml的名称改变而随之改变。在res&#x2F;layout上右键新建，可以创建新的布局文件。文件名首字母必须小写，推荐全小写并<br>用下划线进行单词分割。Root布局可以选择LinearLayout</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">my_layout.xml</span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这是一个垂直走向的布局。<br>接下来可以把setContentView的参数改成<code>R.layout.my_layout</code>。<br>这就是新建布局和修改activity绑定布局的方法。</p>
<h3 id="工程目录结构"><a href="#工程目录结构" class="headerlink" title="工程目录结构"></a>工程目录结构</h3><ul>
<li>app&#x2F;manifests<br>AndroidManifests.xml配置文件目录</li>
<li>app&#x2F;java<br>源代码目录，可以在这里新建包和java文件</li>
<li>app&#x2F;res<br>资源文件目录<ul>
<li>layout 布局资源</li>
<li>menu 菜单资源</li>
<li>values 尺寸、字符串、样式资源</li>
<li>…</li>
</ul>
</li>
</ul>
<h3 id="启动自定义的Activity"><a href="#启动自定义的Activity" class="headerlink" title="启动自定义的Activity"></a>启动自定义的Activity</h3><p>在布局里创建一个按钮，自定义按钮的名字<code>Text</code>和id<code>id</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/btn_change_activity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">&quot;Go to next activity&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>接下来可以使用<br><code>findViewById(R.id.&lt;btn_id&gt;)</code>来找到这个按钮。再对这个函数的返回值调用setOnClickListener方法，并传入一个新建的事件监听器，即可完成对<br>“点击按钮”的响应：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">findViewById(R.id.btn_change_activity).setOnClickListener(</span><br><span class="line">    <span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">                        </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        );</span><br></pre></td></tr></table></figure>

<h4 id="创建新的Activity"><a href="#创建新的Activity" class="headerlink" title="创建新的Activity"></a>创建新的Activity</h4><p>在app&#x2F;src&#x2F;java右键新建，选择Activity-Empty Activity。也可以创建普通的JavaClass，再让其继承Activity即可。Android Studio会自动帮我们在manifest中注册activity，生成对应的java文件和布局xml文件。<br>接下来再来设计新的Activity的布局，可以把ViewText改成“这是另一个Activity”。</p>
<h4 id="进行Activity切换"><a href="#进行Activity切换" class="headerlink" title="进行Activity切换"></a>进行Activity切换</h4><p>使用<code>startActivity</code>方法进行活动的切换，需要使用初始化器创建一个Intent实例作为startActivity的参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">    startActivity(<span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, AnotherAty.class));   </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="查看SDK帮助手册"><a href="#查看SDK帮助手册" class="headerlink" title="查看SDK帮助手册"></a>查看SDK帮助手册</h4><p>新版的AS将手册集成到了源码中，可以在鼠标悬停时显示提示，无需额外下载，但也无法单独查看。需要安装带有源码的SDK，<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/limitzchen/article/details/107747510">https://blog.csdn.net/limitzchen/article/details/107747510</a>,如果SDK没有源码,重新下载并且修改构建的SDK版本<a target="_blank" rel="noopener" href="https://blog.csdn.net/hou09tian/article/details/120105837">https://blog.csdn.net/hou09tian/article/details/120105837</a></p>
<h4 id="Activity生命周期"><a href="#Activity生命周期" class="headerlink" title="Activity生命周期"></a>Activity生命周期</h4><p>一个Acticvity的生命周期如下图所示，从被创建开始，activity可能会经历许多次的暂停-恢复或停止-重启，还有可能因为再在后台被清除而重新创建。</p>
<div align="center">
 <img src="https://raw.githubusercontent.com/huiyeruzhou/MyDrawIo/main/ActivityLifeCycle.drawio.png" width="70%">
</div>

<p>我想有几点是需要注意的:1.activity只要不再活动就会Pause，但只有不可见才会Stop。2.按下返回键时，activity会被destroy，而按下home键则只会Stop。<br>通过导航键找到活动时，如果活动所在的内存已经被清除，就要重新创建，否则就只需Restart。</p>
<p>利用以上几个原则，我们可以得到用一个activity打开另一个activity时的生命周期图：</p>
<p><img src="https://raw.githubusercontent.com/huiyeruzhou/MyDrawIo/main/ActivityInteraction.drawio.png" alt="activity交互图"></p>
<p>如果在AndroidManifest中把新打开的activity的主题设置为对话框，新的活动就不会完全遮住原有的活动。这样，原有的活动的onStop()就不会执行。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> &lt;activity</span><br><span class="line">            android:name=&quot;.AnotherAty&quot;</span><br><span class="line">            android:exported=&quot;false&quot;</span><br><span class="line"><span class="addition">+            android:theme=&quot;@style/Theme.AppCompat.Dialog&quot;</span></span><br><span class="line">            /&gt;</span><br></pre></td></tr></table></figure>
<p>要查看活动生命周期的状况，可以复写<code>on&lt;Action&gt;</code>系列方法，并再其中加入<code>System.out.println();</code>语句这样就可以在输出栏监控各个方法是否执行。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://huiyeruzhou.github.io/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="辉夜">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="辉夜的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/" class="post-title-link" itemprop="url">开发AIDL示例项目的完整流程</a>
        </h2>

        <div class="post-meta">
          
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-12 14:56:43" itemprop="dateCreated datePublished" datetime="2022-04-12T14:56:43+08:00">2022-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-08 22:40:39" itemprop="dateModified" datetime="2023-03-08T22:40:39+08:00">2023-03-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>科研的第二个任务是AIDL和binder机制相关内容，b站上找到了binder源码剖析的很好的讲解，但是AIDL的很多博客都已经过时了。<br>由于本人没有任何安卓开发经验，所以很需要一步一步示范的教程。在ytb上找到了一个教程，基于此解决了Android11以后bindService无法绑定成功、不会回调onServiceConnected的问题，经测试可以在Android12 (Samsung G9910)上跑通</p>
</blockquote>
<h2 id="AIDL概述"><a href="#AIDL概述" class="headerlink" title="AIDL概述"></a>AIDL概述</h2><p>AIDL是安卓为进程间通讯留下的接口，和其他RPC框架一样，AIDL也包括代理层，协议层和通讯层。代理层是安卓的跨进程通讯机制Binder，协议层是安卓接口定义语言AIDL，代理层除了AIDL自动生成的存根代码之外，还需要手动实现服务的绑定以及服务并将存根转换为服务接口。这就构成了整个AIDL的框架。<br>具体实现AIDL的过程分为以下几步：</p>
<ol>
<li>创建服务端项目，编写AIDL</li>
<li>注册服务，实现服务方法并回传服务存根</li>
<li>创建客户端项目，拷贝AIDL</li>
<li>设计客户端UI</li>
<li>在客户端实现业务逻辑</li>
<li>在客户端注册queries</li>
</ol>
<blockquote>
<p><strong>注意，缺少这一步将无法在Android11以上的机器中绑定服务</strong></p>
</blockquote>
<ol start="6">
<li>在客户端实现服务绑定并用AIDL存根作为通讯接口</li>
<li>利用存根中的方法实现需求功能</li>
</ol>
<p>在本例中，我们将实现一个进行四则运算计算器，以及一个计算器的服务器。计算器通过绑定到服务器上的服务来完成计算功能</p>
<h2 id="阅读须知"><a href="#阅读须知" class="headerlink" title="阅读须知"></a>阅读须知</h2><p>本文可以仅需要RPC基础和c语言基础，对于java中类的继承、抽象类、方法等概念只需初步了解，无需Android开发经验</p>
<h2 id="示例开发"><a href="#示例开发" class="headerlink" title="示例开发"></a>示例开发</h2><blockquote>
<p>先决条件：<br>Android Studio<br>Android Studio 虚拟机或开启了USB调试功能的Android实体机</p>
</blockquote>
<h4 id="安装android虚拟机的方法"><a href="#安装android虚拟机的方法" class="headerlink" title="安装android虚拟机的方法"></a>安装android虚拟机的方法</h4><ul>
<li>首先找到设备管理器</li>
</ul>
<p><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/devicemanager.bmp" alt="devicemanager"></p>
<ul>
<li>然后点击创建设备</li>
</ul>
<p><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/createdevice.bmp" alt="createdevice"></p>
<ul>
<li>没有特殊需求就选默认硬件,直接点next</li>
<li>操作系统映像选默认的（和硬件匹配的）点Download，许可协议选accept然后再点next就开始下载了。我这里是已经装好了</li>
</ul>
<p><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/image.bmp" alt="image"></p>
<h4 id="开启USB调试的方法"><a href="#开启USB调试的方法" class="headerlink" title="开启USB调试的方法"></a>开启USB调试的方法</h4><p>这个各个设备不太一样，一般要先在设备信息界面点击某个信息十次解锁，比如我是点击设置-设备信息-软件信息-编译编号解锁开发者模式</p>
<p>解锁了之后在设置-开发者选项里找到<em>USB调试</em>打开就可以了。</p>
<h3 id="1-创建服务端项目，编写AIDL代码"><a href="#1-创建服务端项目，编写AIDL代码" class="headerlink" title="1.创建服务端项目，编写AIDL代码"></a>1.创建服务端项目，编写AIDL代码</h3><h4 id="创建新项目"><a href="#创建新项目" class="headerlink" title="创建新项目"></a>创建新项目</h4><p>从左上角File-New-New Project新建项目，注意选择”Empty Activity”</p>
<p><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/newproject.bmp" alt="newproject"></p>
<p>接下来可以点next，但在最后的界面记得把语言改成java,项目名字我这里叫做AIDLServer</p>
<p><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/java.bmp" alt="java"></p>
<h4 id="创建新的包"><a href="#创建新的包" class="headerlink" title="创建新的包"></a>创建新的包</h4><p>在项目列表里选择java目录，右键，点击new，点击Package，在目录结构里选main</p>
<p><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/newpackage.bmp" alt="newpackage"></p>
<p>给它起个名字，注意过会需要创建这个包的一个副本，所以名字别起太怪，不方便检查，这里叫做AidlPackage</p>
<h4 id="创建新的AIDL文件"><a href="#创建新的AIDL文件" class="headerlink" title="创建新的AIDL文件"></a>创建新的AIDL文件</h4><p>在<strong>刚才的创建的包</strong>上右键创建AIDL文件，名字也别起太怪，这里叫做IAidlDemo</p>
<p><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/newaidlfile.bmp" alt="newaidlfile"></p>
<p>应该能在新建的Aidl文件中看到如下的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IAidlDemo.aidl</span></span><br><span class="line"><span class="keyword">package</span> AidlPackage;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Declare any non-default types here with import statements</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IAidlDemo</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Demonstrates some basic types that you can use as parameters</span></span><br><span class="line"><span class="comment">     * and return values in AIDL.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">basicTypes</span><span class="params">(<span class="keyword">int</span> anInt, <span class="keyword">long</span> aLong, <span class="keyword">boolean</span> aBoolean, <span class="keyword">float</span> aFloat,</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="keyword">double</span> aDouble, String aString)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编写接口定义"><a href="#编写接口定义" class="headerlink" title="编写接口定义"></a>编写接口定义</h4><p>我们要把计算的过程委托给远程服务器，也就是传递两个运算数和一个运算符，接受一个结果。方便起见，规定运算是整数运算，并且用<code>1</code> <code>2</code> <code>3</code> <code>4</code>表示<code>+</code> <code>-</code> <code>*</code> <code>/</code>,这样我们就形成了如下接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IAidlDemo.aidl</span></span><br><span class="line"><span class="keyword">package</span> AidlPackage;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Declare any non-default types here with import statements</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IAidlDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">calculate</span><span class="params">(<span class="keyword">int</span> v1, <span class="keyword">int</span> v2, <span class="keyword">int</span> op)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后需要点击Build-Rebuild Project或者点击右上角配置栏左侧的绿色小锤子进行Make Project。注意，<strong>每次修改AIDL文件都要进行rebuild</strong><br>到此为止，我们的服务应用程序框架就创建完成。</p>
<h3 id="2-注册服务，实现方法"><a href="#2-注册服务，实现方法" class="headerlink" title="2.注册服务，实现方法"></a>2.注册服务，实现方法</h3><p>在APP里右键创建新的Service，注意<strong>不要</strong>选<code>Service(Intent Service)</code>,在接下来的窗口里<code>enabled</code>和<code>exported</code>都要选中</p>
<p><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/newservice.bmp" alt="newservice"></p>
<h4 id="新建存根"><a href="#新建存根" class="headerlink" title="新建存根"></a>新建存根</h4><p>打开新建的服务的java代码<code>app/java/AidlPackage/&lt;ServiceName&gt;.java</code>，为<code>&lt;ServiceName&gt;</code>类添加一个存根变量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> IAidlDemo.Stub</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>注意，这里按下<code>.</code>之后，应该提示后面的Stub类型，如果没有提示就说明刚才没有进行Rebuild！点击下图所示绿色小锤子进行Rebuild</p>
<p><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/rebuild.bmp" alt="rebuild"></p>
<p>确认自己rebuild完成之后继续写。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> IAidlDemo.Stub = <span class="keyword">new</span> IAidlDemo.</span><br></pre></td></tr></table></figure>

<p>现在应该能自动补全Stub了，按Tab键之后，就应该出现类似下面的内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> IAidlDemo.Stub stub = <span class="keyword">new</span> IAidlDemo.Stub() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculate</span><span class="params">(<span class="keyword">int</span> v1, <span class="keyword">int</span> v2, <span class="keyword">int</span> op)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//不会自动打分号</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意到calculate正是我们之前定义的接口定义语言，因为AIDL生成的存根类型是个抽象类，因此系统会自动提醒我们复写其中的<code>calculate</code>方法。</p>
<h4 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h4><p>接下来，我们就来修改这个存根的内部的方法，这里就简单的复制一份代码吧！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> IAidlDemo.Stub stub = <span class="keyword">new</span> IAidlDemo.Stub() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculate</span><span class="params">(<span class="keyword">int</span> v1, <span class="keyword">int</span> v2, <span class="keyword">int</span> op)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span> (op) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">return</span> v1 + v2;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    <span class="keyword">return</span> v1 - v2;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    <span class="keyword">return</span> v1 * v2;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                    <span class="keyword">return</span>  v1 / v2;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    Log.e(<span class="string">&quot;Error: &quot;</span>,<span class="string">&quot;Invalid Operator&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//记得打分号</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>由于这是一个远程方法，因此默认可能会抛出一个远程异常，不过我们不必管他，一般不会出现这种情况。</p>
<h4 id="传递存根"><a href="#传递存根" class="headerlink" title="传递存根"></a>传递存根</h4><p>在<code>&lt;ServiceName&gt;.java</code>中应该还有一个默认的方法<code>onBind</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Return the communication channel to the service.</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">&quot;Not yet implemented&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这是因为我们的服务继承了Service抽象类，因此需要实现onBind方法，也就是指定当服务绑定时要进行的操作。我们只需要返回刚才创建的存根即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stub;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>到此为止我们的服务端项目就编写完成，可以跑一下试试看：</p>
<p><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/server.bmp" alt="server"></p>
<p>虽然没有UI界面，但是服务已经就绪了~</p>
<h3 id="3-创建客户端项目，拷贝AIDL"><a href="#3-创建客户端项目，拷贝AIDL" class="headerlink" title="3.创建客户端项目，拷贝AIDL"></a>3.创建客户端项目，拷贝AIDL</h3><p>新建客户端项目可以单开一个project也可以就在这个project里操作，这里选择单开一个project。过程就不再赘述，注意仍然用<code>Empty Activity</code>作为界面。</p>
<p>这里仍然在<code>app\java</code>上右键，选<code>New-Package</code>新建包，注意<strong>包名要与刚刚创建的包名相同</strong><br>在包上右键，新建Aidl文件，注意<strong>文件名要和刚刚创建的文件相同</strong><br><strong>复制</strong>刚刚的Aidl文件内容，粘贴到新的Aidl文件里<br>包名、文件名、文件内容完全相同。<br><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/copyaidl.bmp" alt="copyaidl"></p>
<h3 id="4-设计客户端UI"><a href="#4-设计客户端UI" class="headerlink" title="4.设计客户端UI"></a>4.设计客户端UI</h3><p>打开<code>activity_main.xml</code>默认在创建项目的时候就会有这个文件生成，如果不小心关掉了就从左侧项目目录<code>app/res/layout/</code>目录下打开。<br>请检查一下这个目录，确保其中只有<code>activity_main.xml</code>。在右上角选择以<code>Code</code>方式查看该文件的内容：<br><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/layout.bmp" alt="layout"></p>
<p>文件内容应该如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Hello World!&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个xml制定了应用程序主界面的UI，如果<code>layout</code>文件夹里有多个文件或者这个<code>.xml</code>文件的内容和上述内容不一样，那么很有可能是因为你没有选择<code>EmptyActivity</code>类型的项目，你可自行判断是否需要重建项目。如果你不清楚这个<code>.xml</code>文件的具体行为，可以考虑重建。</p>
<p>接下来我们还是在右上角将视图切换到View，或者你也可以直接复制本项目的<code>.xml</code>文档，直接跳到实现业务逻辑的部分</p>
<h4 id="修改布局"><a href="#修改布局" class="headerlink" title="修改布局"></a>修改布局</h4><p>默认的布局是<code>constraint</code>,这样图标的上下左右位置都需要指定，很麻烦，于是我们把所有的<code>androidx.constraintlayout.widget.ConstraintLayout</code>修改为<code>RelativeLayout</code></p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line"><span class="deletion">- &lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line"><span class="addition">+ &lt;RelativeLayout xmlns: xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="deletion">- &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span></span><br><span class="line"><span class="addition">+ &lt;/RelativeLayout&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果修改成功，Android应该没有任何Warning，并且你会发现Hello World从原来的居中变为出现在左上角。（要查看.xml的效果，你可以在右上角选择<code>Split</code>或<code>View</code>模式）</p>
<h4 id="添加TextView"><a href="#添加TextView" class="headerlink" title="添加TextView"></a>添加TextView</h4><p>我们需要一个文本框来显示结果,把下面这段话粘贴到.xml中，并且删除Hello World（从<code>&lt;</code> 开始删除到 <code>&gt;</code>为止）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/display_result&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_centerHorizontal</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_margin</span>=<span class="string">&quot;20dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;#FDF171&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:hint</span>=<span class="string">&quot;Result&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:padding</span>=<span class="string">&quot;15dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:textSize</span>=<span class="string">&quot;20sp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:textStyle</span>=<span class="string">&quot;bold&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>现在你应该看到这样的文本框：</p>
<p><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/textview.bmp" alt="textview"></p>
<p>所以TextView就是一个文本框，我们设置了默认显示的字符串（hint）、背景颜色、字号、字体等内容信息，还设置了长宽、水平居中、边距等定型定位尺寸。我们可以在java代码中和TextView进行沟通，比如通过setText方法来设置要显示的内容，这样我们就可以把结果输出到这个文本框里。<br>还有值得注意的一点是，每个组建都拥有自己的id，比如<code>@+id/display_result</code>就对应我们刚刚的文本框，因为我们的第一行就指明了他的id。这个id1可以在xml中描述组件之间的相对关系，也可以在java中用于绑定组件信息。</p>
<h4 id="添加EditText"><a href="#添加EditText" class="headerlink" title="添加EditText"></a>添加EditText</h4><p>我们需要两个文本框来接受输入的运算数</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/enter_first_value&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;50dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_below</span>=<span class="string">&quot;@+id/display_result&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginStart</span>=<span class="string">&quot;20dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;20dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginBottom</span>=<span class="string">&quot;20dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:ems</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:hint</span>=<span class="string">&quot;Enter First Value&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:imeOptions</span>=<span class="string">&quot;actionNext&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:inputType</span>=<span class="string">&quot;number&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:maxLength</span>=<span class="string">&quot;5&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:singleLine</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/enter_next_value&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;50dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_below</span>=<span class="string">&quot;@+id/enter_first_value&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginStart</span>=<span class="string">&quot;20dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;20dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginEnd</span>=<span class="string">&quot;20dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginBottom</span>=<span class="string">&quot;20dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:autofillHints</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:ems</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:hint</span>=<span class="string">&quot;Enter Next Value&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:inputType</span>=<span class="string">&quot;number&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:maxLength</span>=<span class="string">&quot;5&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:singleLine</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>开头是一个id号，而所有含有layout的都是定型尺寸和定位尺寸，这里注意<code>layout_below</code>指明它要放在上面那个文本框的下方。这里还限制了输入类型是数字，最多输入5个且只接受单行输入。</p>
<h4 id="添加按钮"><a href="#添加按钮" class="headerlink" title="添加按钮"></a>添加按钮</h4><p>首先添加四则运算，这四个按钮之间的位置关系通过<code>layout_below</code>和<code>layout_toEndOf</code>来指定，可以看到加法减法位于同一行，乘法除法位于同一行，减法除法在加法乘法右侧。<br>按钮默认全字大写，所以这里关闭了<code>textAllCaps</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/add&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;100dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_below</span>=<span class="string">&quot;@+id/enter_next_value&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;20dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;#0288D1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">&quot;Add&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:textAllCaps</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:textColor</span>=<span class="string">&quot;#ffff&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/subtract&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;100dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_below</span>=<span class="string">&quot;@+id/enter_next_value&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginStart</span>=<span class="string">&quot;20dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_toEndOf</span>=<span class="string">&quot;@+id/add&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;#0288D1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">&quot;Subtract&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:textAllCaps</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:textColor</span>=<span class="string">&quot;#ffff&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/multiply&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;100dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_below</span>=<span class="string">&quot;@+id/add&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;20dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;#0288D1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">&quot;Multiply&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:textAllCaps</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:textColor</span>=<span class="string">&quot;#ffff&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/divide&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;100dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_below</span>=<span class="string">&quot;@+id/subtract&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginStart</span>=<span class="string">&quot;20dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_toEndOf</span>=<span class="string">&quot;@+id/multiply&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;#0288D1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">&quot;Divide&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:textAllCaps</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:textColor</span>=<span class="string">&quot;#ffff&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>这两个按钮是用于清零和绑定服务的，让他们居中。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/clear_data&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_below</span>=<span class="string">&quot;@+id/division&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_centerHorizontal</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">&quot;Clear Data&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/bind_service&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_below</span>=<span class="string">&quot;@+id/clear_data&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_centerHorizontal</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">&quot;Bind Service&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>整体效果应该如图：<br><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/ui.bmp" alt="ui"></p>
<p>注意，各个按钮之间的相对关系是通过id指定的，如果更改了id多半会有error，修改id修复error即可<br>另外会有一些warning，比如叫你把字符串做编码之类的，建议不懂的话忽略就好</p>
<p>这就是我们的ui界面了！AndroidUI的设计还是很简洁的，但是背后是项目自动为我们生成的许多文件~</p>
<h3 id="5-实现业务逻辑"><a href="#5-实现业务逻辑" class="headerlink" title="5.实现业务逻辑"></a>5.实现业务逻辑</h3><p>接下来我们将开始修改客户端的java代码，实现和前端组件的交互、业务流程、服务绑定以及利用远程服务实现功能！</p>
<h4 id="修改主类，继承事件监听"><a href="#修改主类，继承事件监听" class="headerlink" title="修改主类，继承事件监听"></a>修改主类，继承事件监听</h4><p>下面打开客户端的<code>MainActivity.java</code>,这里我们可以直接修改主类，让主类完成对UI事件的监听，于是：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package com.example.aidlclient;</span><br><span class="line"></span><br><span class="line">import ...</span><br><span class="line"></span><br><span class="line"><span class="deletion">- public class MainActivity extends AppCompatActivity &#123;</span></span><br><span class="line"><span class="addition">+ public class MainActivity extends Activity implements View.OnClickListener &#123;</span></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">//注意别漏了左大括号</span><br></pre></td></tr></table></figure>

<p>这样它马上就会报错，先把鼠标放到<code>View.OnClickListener</code>里，可以看到这样的提示：<br><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/implement.bmp" alt="implement"></p>
<p>我们赶紧按<code>ALT+ENTER</code>自动导入这个包，之后把鼠标挪到extend后面的<code>Activity</code>上，再导入一次。他可能会要你选是导入还是创建，就选<code>Import Class Activity</code>就行。<br>不过还是有错，这是因为我们继承了一个抽象类，必须实现其方法，所以我们在主类里再写一个方法注意方法名称、形参、返回值必须一模一样：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package com.example.aidlclient;</span><br><span class="line"></span><br><span class="line">import ...</span><br><span class="line">public class MainActivity extends Activity implements View.OnClickListener&#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="addition">+   @Override</span></span><br><span class="line"><span class="addition">+   public void onClick (View view) &#123;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+   &#125;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在应该一个error都没有了。</p>
<h4 id="初始化UI"><a href="#初始化UI" class="headerlink" title="初始化UI"></a>初始化UI</h4><p>首先在类里声明私有成员：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package com.example.aidlclient;</span><br><span class="line"></span><br><span class="line">import ...</span><br><span class="line">public class MainActivity extends Activity implements View.OnClickListener&#123;</span><br><span class="line"><span class="addition">+    private TextView textViewDisplayResult;</span></span><br><span class="line"><span class="addition">+    private EditText editTextFirstValue, editTextNextValue;</span></span><br><span class="line"><span class="addition">+    private Button buttonAdd,buttonSubtract, buttonMultiply, buttonDivide, buttonClearData,buttonBind;</span></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>成员的名字无所谓，只要和之后的业务逻辑里面的代码对上就行。但接下来要实例化UI对象，这就必须和之前UI里设计时候的id一一对应了！<br>onCreate是活动被创建时会执行的方法，下面在onCreate方法中编写函数体：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Initialize UI</span></span><br><span class="line">    textViewDisplayResult = findViewById(R.id.display_result);</span><br><span class="line">    editTextFirstValue = findViewById(R.id.enter_first_value);</span><br><span class="line">    editTextNextValue = findViewById(R.id.enter_next_value);</span><br><span class="line">    buttonAdd = findViewById(R.id.add);</span><br><span class="line">    buttonSubtract = findViewById(R.id.subtract);</span><br><span class="line">    buttonDivide = findViewById(R.id.divide);</span><br><span class="line">    buttonMultiply = findViewById(R.id.multiply);</span><br><span class="line">    buttonClearData = findViewById(R.id.clear_data);</span><br><span class="line">    buttonBind = findViewById(R.id.bind_service);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//click listener</span></span><br><span class="line">    buttonAdd.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">    buttonSubtract.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">    buttonDivide.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">    buttonMultiply.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">    buttonClearData.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">    buttonBind.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意findViewById中必须传对应的id名，否则会报错。这个函数完成了UI的初始化并且把按钮的事件监听器绑定到本类</p>
<p>首先编写事件监听器的逻辑,也就是onClick方法，不同的按钮被点击之后，我们让他们调用不同的方法进行响应。<br>这里有两个方法尚未实现：<code>bindToDemoService</code>和<code>verifyAndCalculate</code>，前者是Bind Service按钮用来绑定服务的方法，后者是四个小按钮进行计算的方法。<br>在这里我们完全实现的只有Clear Data，注意到它通过setText方法将三个文本框的内容都设置为null，这样就会展示hint内容，也就是我们一开始设置的提示信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span> <span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(view.getId())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.add:</span><br><span class="line">                verifyAndCalculate(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.subtract:</span><br><span class="line">                verifyAndCalculate(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.multiply:</span><br><span class="line">                verifyAndCalculate(<span class="number">3</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.divide:</span><br><span class="line">                verifyAndCalculate(<span class="number">4</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.clear_data:</span><br><span class="line">                editTextNextValue.setText(<span class="keyword">null</span>);</span><br><span class="line">                editTextFirstValue.setText(<span class="keyword">null</span>);</span><br><span class="line">                textViewDisplayResult.setText(<span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.bind_service:</span><br><span class="line">                bindToDemoService();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>接下来我们来实现<code>verifyAndCalculate</code>，它首先验证是否两个输入文本框内都有内容，如果都有的话就获取内容并进行计算、显示结果。如果没有的话就在屏幕上显示一个小消息框（就是平时看到的那种<code>网络连接不佳</code>的小消息框&gt;_&lt;）<br>注意这里的calculateData方法<strong>是假的</strong>！完成服务绑定后我们会把他替换成通过stub调用的远程方法，到时候我们会对这部分的代码再加以改动，如果想获得最终版本的verifyAndCalculate可以直接到最后部分查看。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">verifyAndCalculate</span><span class="params">(<span class="keyword">int</span> op)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(isAnyValueMissing())&#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>,<span class="string">&quot;Please enter the values&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        <span class="comment">//Toast就是用来显示小弹窗的东西</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> result,firstValue,nextValue;</span><br><span class="line">        firstValue = Integer.parseInt(editTextFirstValue.getText().toString());</span><br><span class="line">        nextValue = Integer.parseInt(editTextNextValue.getText().toString());</span><br><span class="line">        <span class="comment">//获取信息，转换为字符串，再用整数包裹把字符串解析为整数</span></span><br><span class="line"></span><br><span class="line">        result = calculateData(firstValue,nextValue,op);</span><br><span class="line">        textViewDisplayResult.setText(<span class="string">&quot;&quot;</span>+result);</span><br><span class="line">        <span class="comment">//利用空字符串完成int到String的强制转换</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isAnyValueMissing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> editTextFirstValue.getText().toString().isEmpty() ||</span><br><span class="line">            editTextNextValue.getText().toString().isEmpty();</span><br><span class="line">    <span class="comment">//我个人感觉面向对象语言已经充分自注释了哈哈哈哈</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到此为止，我们的业务逻辑已经编写完成，按下按钮会调用函数并传递运算符类型。</p>
<h3 id="6-在客户端注册queries"><a href="#6-在客户端注册queries" class="headerlink" title="6.在客户端注册queries"></a>6.在客户端注册queries</h3><p>首先，打开<strong>服务端</strong>项目，在<code>app/menifests/AndroidMenifest.xml</code>里找到服务程序的包名和服务名：<br><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/packageandservice.bmp" alt="packageandservice"><br>这两个名字都记下来，现在这里先用包名。打开<strong>客户端</strong>项目，在<code>app/menifests/AndroidMenifest.xml</code>中，<code>manifest</code>标签里，与<code>application</code>标签同级。这里的<br><code>&quot;com.example.aidlserver&quot;</code>替换成自己的<strong>服务端</strong>包名</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line"> &lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    package=&quot;com.example.mydemo&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;application</span><br><span class="line">    ...</span><br><span class="line">    &lt;/application&gt;</span><br><span class="line"><span class="addition">+    &lt;queries&gt;</span></span><br><span class="line"><span class="addition">+        &lt;package android:name=&quot;com.example.aidlserver&quot; /&gt;</span></span><br><span class="line"><span class="addition">+    &lt;/queries&gt;</span></span><br><span class="line"> &lt;/manifest&gt;</span><br></pre></td></tr></table></figure>

<p>从Android 11开始，应用程序要想访问别的应用，就必须指明该应用程序的包，很多不够新的教程里都没有这个阶段，因此无法正常运行。</p>
<h4 id="7-绑定服务"><a href="#7-绑定服务" class="headerlink" title="7.绑定服务"></a>7.绑定服务</h4><p>这里我们来实现bindToDemoService方法，在<code>MainActivity.java</code>里，将下列内容填写进函数体，大家可以参照注释来理解代码。需要做的替换内容，也都在注释中说明。如果代码有变红的，就是因为有包没导入，用把鼠标放到红色的字上，<code>ALT+ENTER</code>导入</p>
<h2 id="未完待续-以下全是草稿"><a href="#未完待续-以下全是草稿" class="headerlink" title="未完待续 以下全是草稿"></a>未完待续 以下全是草稿</h2><p>注意：<code>ComponentName</code>的第一个参数是刚才记下来的服务端包名，第二个参数是<code>&quot;&lt;包名&gt;.&lt;服务名&gt;&quot;</code>。<br>这里要用到bindService方法，因此还需要准备一个ServiceConnection对象，<br>我们需要复写其中的onServiceConnected方法，也就是服务接通之后的回调方法，这里用先打印一个提示信息，然后再将IBinder转换为Aidl存根。<code>aidlObject = IAidlDemo.Stub.asInterface(iBinder);</code>,其中aidlObject可以声明为一个私有变量。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> IAidlDemo aidlObject;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">bindToDemoService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">&quot;Service connecting&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    Intent serviceIntentExplicit = <span class="keyword">new</span> Intent();</span><br><span class="line">    serviceIntentExplicit.setComponent(<span class="keyword">new</span> ComponentName(<span class="string">&quot;com.example.aidlserver&quot;</span>, <span class="string">&quot;com.example.aidlserver.Calculate&quot;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="keyword">boolean</span> qaq = bindService(</span><br><span class="line">            serviceIntentExplicit,</span><br><span class="line">            serviceConnectionObject,Context.BIND_AUTO_CREATE);</span><br><span class="line">    <span class="keyword">if</span> (!qaq) &#123;</span><br><span class="line">        Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">&quot;Please start server&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ServiceConnection serviceConnectionObject = <span class="keyword">new</span> ServiceConnection() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName componentName, IBinder iBinder)</span> </span>&#123;</span><br><span class="line">        Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">&quot;Service connected&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        aidlObject = IAidlDemo.Stub.asInterface(iBinder);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName componentName)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/12/%E5%BC%80%E5%8F%91AIDL%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B/remotee.bmp" alt="remotee"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    result = aidlObject.calculate(firstValue,nextValue,op</span><br><span class="line">&#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">textViewDisplayResult.setText(<span class="string">&quot;&quot;</span>+result);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://huiyeruzhou.github.io/2022/04/08/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="辉夜">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="辉夜的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/08/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B/" class="post-title-link" itemprop="url">从零开始</a>
        </h2>

        <div class="post-meta">
          
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-08 18:41:50" itemprop="dateCreated datePublished" datetime="2022-04-08T18:41:50+08:00">2022-04-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-08 22:40:39" itemprop="dateModified" datetime="2023-03-08T22:40:39+08:00">2023-03-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>很不幸的一件事情是,前段时间本人因为修过windows用户名及大量相关注册表把自己的操作系统搞炸了,其中还包括重要的wsl…本文主要讲解一下重装系统的过程,供以后参考</p>
</blockquote>
<h3 id="需要准备的文件"><a href="#需要准备的文件" class="headerlink" title="需要准备的文件"></a>需要准备的文件</h3><ul>
<li>个人临时文件和工作文件,下载文件,软件保存的文件</li>
<li>大型软件的安装映像,虚拟机的虚拟磁盘  </li>
<li>.家目录下的ssh密钥, vscode的settings.json,vsc插件列表</li>
</ul>
<h3 id="登陆操作系统"><a href="#登陆操作系统" class="headerlink" title="登陆操作系统"></a>登陆操作系统</h3><p>这回记得给自己起个阳间点的名字,不要再出现非ASCII字符或带有特殊含义的字符了,只用英文字母和数字比较稳妥.</p>
<h3 id="加载备份文件"><a href="#加载备份文件" class="headerlink" title="加载备份文件"></a>加载备份文件</h3><p>一般来讲,被逼到重装系统的时候已经没什么可以备份的软件和配置了,于是只能加载备份文件.一般来讲,可以分为:下载的文件&#x2F;项目文档&#x2F;一般文档&#x2F;软件保存的文档.</p>
<ul>
<li>下载的文件可以直接放到下载文件夹里</li>
<li>项目文档和个人文档放到原路径</li>
<li>软件保存的文档先留着,等下完软件再放到他们自己的下载路径</li>
</ul>
<p>这样可以确保再想找的时候一定能找到</p>
<h3 id="重新安装软件"><a href="#重新安装软件" class="headerlink" title="重新安装软件"></a>重新安装软件</h3><p>首先安装latern,然后安装clash,然后安装IDM,chrome<br>接下来安装QQ,微信,腾讯会议,火绒,讯飞输入法,网易云音乐,WinRAR<br>vscode,wsl,git,windows terminal<br>如果有大型软件可以等有空了再安装,其他软件可以按需安装  </p>
<h3 id="重新加载配置"><a href="#重新加载配置" class="headerlink" title="重新加载配置"></a>重新加载配置</h3><ol>
<li>网络配置<br>用小蓝灯登录小蓝猫的官网,加载小蓝猫的配置<br>按照这篇文章为wsl配置代理<br><a target="_blank" rel="noopener" href="https://zinglix.xyz/2020/04/18/wsl2-proxy/">https://zinglix.xyz/2020/04/18/wsl2-proxy/</a><br>安装谷歌tampermonkey插件,在gressyfork插件里找到简易下载助手<br>为IDM进行谷歌插件配置,然后点击”绿化.bat”完成配置<a target="_blank" rel="noopener" href="https://blog.csdn.net/Cappuccino_jay/article/details/105299073">https://blog.csdn.net/Cappuccino_jay/article/details/105299073</a></li>
<li>软件配置<br>vsc: 加载settings.json,重新安装插件（现在可以使用sync插件进行同步）<br>git: 确认ssh链接良好,如果没有就再配一个,config文件也要改一下<br>微信&#x2F;qq: 更改下载路径,并且把之前下载的文件也扔进去<br>Android Studio：汉字中文乱码需要将File-Settings-Editor-Encoding的所有选项都改成UTF-8.还需要在studio64.exe.vmoptions里加一句“-Dfile.encoding&#x3D;UTF-8”，注意要在安装目录下的文件里加，不能直接在help里找这个选项修改否则会无法启动。</li>
<li>其他配置<br>按照这篇文章重新配置nodejs和hexo<a target="_blank" rel="noopener" href="https://blog.csdn.net/DreamcoffeeZS/article/details/79401109">https://blog.csdn.net/DreamcoffeeZS/article/details/79401109</a><br>hexo配置图片并且能按markdown格式预览：<code>npm i -s hexo-asset-link</code> (似乎不需要用hexo-asset-image<a target="_blank" rel="noopener" href="https://blog.csdn.net/xjm850552586/article/details/84101345">https://blog.csdn.net/xjm850552586/article/details/84101345</a>)<br>按照这篇文章重新加载latex(不要按照这个配置settings.json) <a target="_blank" rel="noopener" href="https://blog.csdn.net/yinqingwang/article/details/79684419">https://blog.csdn.net/yinqingwang/article/details/79684419</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://huiyeruzhou.github.io/2022/03/23/gRPC%E6%A1%86%E6%9E%B6%E8%B0%83%E7%A0%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="辉夜">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="辉夜的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/23/gRPC%E6%A1%86%E6%9E%B6%E8%B0%83%E7%A0%94/" class="post-title-link" itemprop="url">gRPC调研报告</a>
        </h2>

        <div class="post-meta">
          
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-23 17:53:19" itemprop="dateCreated datePublished" datetime="2022-03-23T17:53:19+08:00">2022-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-08 22:40:39" itemprop="dateModified" datetime="2023-03-08T22:40:39+08:00">2023-03-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><table>
<thead>
<tr>
<th>框架名称</th>
<th>开发者</th>
<th>序列化协议</th>
<th>传输协议</th>
<th>支持语言</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>gRPC</td>
<td>google</td>
<td>protobuf</td>
<td>http2.0</td>
<td>多语言</td>
<td>没有服务治理功能，序列化效率最好，性能较高</td>
</tr>
<tr>
<td>rpcx</td>
<td></td>
<td>portobuf+多种</td>
<td></td>
<td>Go服务+多语言客户</td>
<td>性能最高，</td>
</tr>
<tr>
<td>Thrift</td>
<td>facebook</td>
<td>bin(compact) json</td>
<td>tcp:socket http:frame file</td>
<td>多语言</td>
<td>性能一般，缺乏技术文档</td>
</tr>
<tr>
<td>Motan</td>
<td>Weibo</td>
<td>json hessian2</td>
<td>tcp</td>
<td>Java</td>
<td>基于Dubbo剪裁,擅长处理大批量负载</td>
</tr>
<tr>
<td>brpc</td>
<td>Baidu</td>
<td>protobuf</td>
<td></td>
<td>C++</td>
<td></td>
</tr>
</tbody></table>
<!-- |erpc -->

<h2 id="RPC简介，gRPC原理"><a href="#RPC简介，gRPC原理" class="headerlink" title="RPC简介，gRPC原理"></a>RPC简介，gRPC原理</h2><h2 id="gRPC"><a href="#gRPC" class="headerlink" title="gRPC"></a>gRPC</h2><ul>
<li><p>优点</p>
</li>
<li><p>微服务：gRPC 设计用于低延迟和高吞吐量通信。 gRPC 对于效率至关重要的轻量级微服务非常有用。</p>
</li>
<li><p>网络带宽要求低：gRPC 消息使用 Protobuf进行序列化。 这种序列化方法的时空效率都要比json，thrift，hessian强</p>
</li>
<li><p>多语言环境：gRPC 工具支持所有常用的开发语言(C++，Java，Python，Ruby，Go…)</p>
</li>
<li><p>点对点实时通信：gRPC 对双向流式传输提供出色的支持。 gRPC 服务可以实时推送消息而无需轮询。</p>
</li>
<li><p>缺点</p>
</li>
<li><p>只有少数浏览器支持http2</p>
</li>
<li><p>移动端网络可能在wifi及4G频繁切换，无法体现出长连接以及多路复用的优势</p>
</li>
<li><p>相较于json，protobuf编码后数据可读性低</p>
</li>
</ul>
<h2 id="rpcx、"><a href="#rpcx、" class="headerlink" title="rpcx、"></a>rpcx、</h2><h2 id="Thrift-vs-gRPC"><a href="#Thrift-vs-gRPC" class="headerlink" title="Thrift vs gRPC"></a>Thrift vs gRPC</h2><ul>
<li>优点</li>
</ul>
<ul>
<li>高性能，gPRC平均响应延迟差距在2倍左右</li>
<li>序列化和传输层可拔插，提供了多种方法</li>
</ul>
<ul>
<li>不足</li>
</ul>
<ul>
<li>开发环境生态很差，缺乏说明文档和软件更新</li>
<li>不擅长提供大量流式数据传输</li>
</ul>
<h2 id="Motan-vs-gPRC"><a href="#Motan-vs-gPRC" class="headerlink" title="Motan vs gPRC"></a>Motan vs gPRC</h2><ul>
<li>优点</li>
</ul>
<ul>
<li>提供了服务治理功能</li>
<li>极限情况下的最长响应时间很短</li>
</ul>
<ul>
<li>不足</li>
</ul>
<ul>
<li>序列化效率较低</li>
<li>综合运行效率较低</li>
<li>只支持Java语言</li>
</ul>
<h2 id="erpc"><a href="#erpc" class="headerlink" title="erpc"></a>erpc</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://huiyeruzhou.github.io/2022/03/19/%E4%B8%80%E7%94%9F%E4%B8%80%E8%8A%AF%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="辉夜">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="辉夜的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/19/%E4%B8%80%E7%94%9F%E4%B8%80%E8%8A%AF%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/" class="post-title-link" itemprop="url">一生一芯 实验报告</a>
        </h2>

        <div class="post-meta">
          
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-19 21:42:32" itemprop="dateCreated datePublished" datetime="2022-03-19T21:42:32+08:00">2022-03-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-21 18:38:18" itemprop="dateModified" datetime="2022-04-21T18:38:18+08:00">2022-04-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>哈尔滨工业大学 于鸿利 22040866</p>
</blockquote>
<h1 id="预学习阶段"><a href="#预学习阶段" class="headerlink" title="预学习阶段"></a>预学习阶段</h1><h2 id="如何科学的提问"><a href="#如何科学的提问" class="headerlink" title="如何科学的提问"></a>如何科学的提问</h2><p>见读后感</p>
<h2 id="Linux系统安装和基本使用"><a href="#Linux系统安装和基本使用" class="headerlink" title="Linux系统安装和基本使用"></a>Linux系统安装和基本使用</h2><ul>
<li><p>安装一个linux操作系统</p>
<p>  复用了wsl2-ubantu20.04</p>
<p>  首先将windows版本更新到build 21362+（win11即可），然后以管理员权限打开命令行</p>
<p>  输入wsl –update即可将已有的windows subsystem for linux更新到带有图形用户界面的版本</p>
</li>
<li><p>获取一生一芯框架代码</p>
<p>添加ssh密钥</p>
<p>按照讲义clone一个本地项目即可</p>
</li>
</ul>
<h2 id="复习C语言"><a href="#复习C语言" class="headerlink" title="复习C语言"></a>复习C语言</h2><p>* </p>
<h2 id="搭建verilator仿真环境"><a href="#搭建verilator仿真环境" class="headerlink" title="搭建verilator仿真环境"></a>搭建verilator仿真环境</h2><ul>
<li><p>认识verilator</p>
<p>  开源的数字电路仿真软件</p>
</li>
<li><p>安装verilator</p>
<p> make install编译了十几分钟啧啧啧</p>
</li>
<li><p>运行示例</p>
<p> 按照手册中的说明编写了our.v, sim_main.cpp，编译并运行了程序</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">verilator -Wall --cc --exe --build sim_main.cpp our.v</span><br></pre></td></tr></table></figure>
<p> 结果是这样的</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hello World</span><br><span class="line">our.v:2: Verilog $finish</span><br></pre></td></tr></table></figure></li>
<li><p>对双控开关模块进行仿真</p>
<p>  具体而言，需要调整的内容有：</p>
<ol>
<li><p>.v文件名要修改为top.v</p>
</li>
<li><p>cpp 文件中要引入头文件</p>
</li>
<li><p>cpp 文件中</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vour* top = new Vour&#123;contextp&#125;;</span><br></pre></td></tr></table></figure>
<p>  的类名要改为Vour</p>
</li>
<li><p>编译语句中的文件名要做相应的更改</p>
</li>
</ol>
</li>
</ul>
<p>结果是这样的<br>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a = 0, b = 1, f = 1</span><br><span class="line">a = 1, b = 0, f = 1</span><br><span class="line">a = 0, b = 0, f = 0</span><br><span class="line">a = 0, b = 1, f = 1</span><br><span class="line">a = 0, b = 1, f = 1</span><br><span class="line">a = 0, b = 1, f = 1</span><br><span class="line">^C</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>理解RTL仿真的行为</p>
</li>
<li><p>一键仿真</p>
<figure class="highlight mak"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成的可执行文件名称</span></span><br><span class="line">TOPNAME = top</span><br><span class="line"><span class="comment">#在指定文件夹中按扩展名查找所有源文件</span></span><br><span class="line">VSRC = <span class="variable">$(<span class="built_in">shell</span> find $(<span class="built_in">abspath</span> ./vsrc)</span> -name <span class="string">&quot;*.v&quot;</span>)</span><br><span class="line">CSRC = <span class="variable">$(<span class="built_in">shell</span> find $(<span class="built_in">abspath</span> ./csrc)</span> -name <span class="string">&quot;*.c&quot;</span> -or -name <span class="string">&quot;*.cc&quot;</span> -or -name <span class="string">&quot;*.cpp&quot;</span>)</span><br><span class="line"><span class="comment">#nvbroad自动绑定源文件，注意，如果没有$(BUILD_DIR)目录，将无法正确的生成该文件</span></span><br><span class="line">SRC_AUTO_BIND = <span class="variable">$(<span class="built_in">abspath</span> <span class="variable">$(BUILD_DIR)</span>/auto_bind.cpp)</span></span><br><span class="line">CSRC += <span class="variable">$(SRC_AUTO_BIND)</span></span><br><span class="line"><span class="comment">#nvbroad约束文件</span></span><br><span class="line">CONSTR = constr/top.nxdc</span><br><span class="line"></span><br><span class="line"><span class="comment">#构建目录、verilator目标目录、可执行文件存放路径</span></span><br><span class="line">BUILD_DIR = ./build</span><br><span class="line">OBJ_DIR = <span class="variable">$(BUILD_DIR)</span>/obj_dir</span><br><span class="line">BIN = <span class="variable">$(BUILD_DIR)</span>/<span class="variable">$(TOPNAME)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#传递给verilator的参数：以c++形式输出调试信息，并自动依据makefile进行构建</span></span><br><span class="line">VERIARG = -Wall --cc -MMD --build </span><br><span class="line"></span><br><span class="line"><span class="comment">#传递给preproject连接器的信息，添加SDL2库信息</span></span><br><span class="line">LDFLAGS += -lSDL2 -lSDL2_image</span><br><span class="line"></span><br><span class="line"><span class="comment">#包含文件路径，加前缀-I传递给g++，INC_PATH在nvbroad.mk中定义</span></span><br><span class="line">INCFLAGS = <span class="variable">$(<span class="built_in">addprefix</span> -I, <span class="variable">$(INC_PATH)</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#传递给g++的编译参数，包括包含路径和TOP_NAME的定义</span></span><br><span class="line">CFLAGS += <span class="variable">$(INCFLAGS)</span>  -DTOP_NAME=<span class="string">&quot;\&quot;V<span class="variable">$(TOPNAME)\&quot;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#包含nvbroad.mk</span></span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(NVBOARD_HOME)</span>/scripts/nvboard.mk</span><br><span class="line"><span class="comment">#新建构建目录，防止出现无法新建autobind.cpp的错误</span></span><br><span class="line"><span class="variable">$(<span class="built_in">shell</span> mkdir -p <span class="variable">$(BUILD_DIR)</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#默认的构建对象</span></span><br><span class="line"><span class="section">sim:  <span class="variable">$(CSRC)</span> <span class="variable">$(VSRC)</span> <span class="variable">$(NVBOARD_ARCHIVE)</span></span></span><br><span class="line"><span class="comment">#提交当前存储区，提交信息为sim RTL</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> git_commit, &quot;sim RTL&quot;)</span> <span class="comment"># DO NOT REMOVE THIS LINE!!!</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">#运行verilator，传递给其编译参数</span></span><br><span class="line"><span class="comment">#指定top模块名称</span></span><br><span class="line"><span class="comment">#添加所有源文件和nvbroad库</span></span><br><span class="line"><span class="comment">#传递所有preproject连接器参数，加前缀</span></span><br><span class="line"><span class="comment">#传递所有编译器参数，加前缀</span></span><br><span class="line"><span class="comment">#指定生成对象目录，生成可执行文件，输出路径为预先指定的可执行文件存储路径</span></span><br><span class="line">	verilator <span class="variable">$(VERIARG)</span> \</span><br><span class="line">		-top <span class="variable">$(TOPNAME)</span> \</span><br><span class="line">		<span class="variable">$^</span> \</span><br><span class="line">		<span class="variable">$(<span class="built_in">addprefix</span> -LDFLAGS , <span class="variable">$(LDFLAGS)</span>)</span> \</span><br><span class="line">		<span class="variable">$(<span class="built_in">addprefix</span> -CFLAGS , <span class="variable">$(CFLAGS)</span>)</span> \</span><br><span class="line">		--Mdir <span class="variable">$(OBJ_DIR)</span>  --exe -o <span class="variable">$(<span class="built_in">abspath</span> <span class="variable">$(BIN)</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#自动绑定文件，由于其被可执行文件依赖，会先生成该文件。调用python执行nvbroad自带的.py文件，输入约束文件，输出自动绑定文件</span></span><br><span class="line"><span class="variable">$(SRC_AUTO_BIND)</span>: <span class="variable">$(CONSTR)</span> </span><br><span class="line">	python3 <span class="variable">$(NVBOARD_HOME)</span>/scripts/auto_pin_bind.py  <span class="variable">$^</span> <span class="variable">$@</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>运行NVBoard示例</p>
<p> 看到了一组循环显示数字的数码管，还有南京大学的 “北 大楼”（南大的高中同学告诉我的） </p>
</li>
<li><p>在NVBoard上实现双控开关</p>
<p>  我使用如下的代码来完成引脚绑定:</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">top=top</span><br><span class="line"></span><br><span class="line">a SW0<span class="comment">//开关0</span></span><br><span class="line">b SW1<span class="comment">//开关1</span></span><br><span class="line">f LD0<span class="comment">//LED0显示输出</span></span><br></pre></td></tr></table></figure>
<p>配合如下激励代码来连接面板</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nvboard_bind_all_pins</span>(&amp;dut);</span><br><span class="line"><span class="built_in">nvboard_init</span>();</span><br><span class="line"><span class="comment">/*verilate*/</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  dut.<span class="built_in">eval</span>();</span><br><span class="line">  <span class="built_in">nvboard_update</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="数字电路基础实验"><a href="#数字电路基础实验" class="headerlink" title="数字电路基础实验"></a>数字电路基础实验</h2><h3 id="实验一-选择器"><a href="#实验一-选择器" class="headerlink" title="实验一 选择器"></a>实验一 选择器</h3><ul>
<li>上板实验: 二位四选一选择器</li>
</ul>
<p>我使用如下的代码来搭建top模块:</p>
<figure class="highlight v"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top(a,s,y);</span><br><span class="line">  <span class="keyword">input</span>  [<span class="number">7</span>:<span class="number">0</span>] a;</span><br><span class="line">  <span class="keyword">input</span>  [<span class="number">1</span>:<span class="number">0</span>] s;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] y;</span><br><span class="line">  MuxKeyWithDefault <span class="variable">#(4, 2, 2)</span> i0 (y, s, <span class="number">2&#x27;b00</span>, &#123;</span><br><span class="line">    <span class="number">2&#x27;b00</span>, a[<span class="number">1</span>:<span class="number">0</span>],</span><br><span class="line">    <span class="number">2&#x27;b01</span>, a[<span class="number">3</span>:<span class="number">2</span>],</span><br><span class="line">    <span class="number">2&#x27;b10</span>, a[<span class="number">5</span>:<span class="number">4</span>],</span><br><span class="line">    <span class="number">2&#x27;b11</span>, a[<span class="number">7</span>:<span class="number">6</span>]</span><br><span class="line">  &#125;);<span class="comment">//默认模板，参数分别为：输出端、选择端、默认值、选择-输出键值对</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>可以看到, 双输出的选择器要改变a和y的位宽,调整模板的参数,并且对default output的位宽和键值对的输出值的位宽做相应的调整<br>我使用如下的代码来完成引脚绑定:</p>
<figure class="highlight v"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">top=top     <span class="comment">//设置TOP_NAME为top</span></span><br><span class="line"></span><br><span class="line">s (SW1, SW0)<span class="comment">//这两个开关作为选择端</span></span><br><span class="line">a (SW9, SW8, SW7, SW6, SW5, SW4, SW3, SW2)<span class="comment">//这八个开关作为输入端，每两个开关一组，共四组。</span></span><br><span class="line">y (LD1, LD0)<span class="comment">//用LED显示输出</span></span><br></pre></td></tr></table></figure>
<p>这里按照实验的建议用开关作为输入,led灯作为输出</p>
<p>我使用如下的代码来完成激励代码的主体部分:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> TOP_NAME dut;<span class="comment">//nvbroad接口，宏自动展开为Vtop</span></span><br><span class="line"><span class="built_in">nvboard_bind_all_pins</span>(&amp;dut);<span class="comment">//绑定所有引脚</span></span><br><span class="line"><span class="built_in">nvboard_init</span>();<span class="comment">//初始化面板</span></span><br><span class="line"><span class="comment">/*verilate*/</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  dut.<span class="built_in">eval</span>();<span class="comment">//获取当前数据</span></span><br><span class="line">  <span class="built_in">nvboard_update</span>();<span class="comment">//重绘面板</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更新值并且更新版面图像即可,我已经看过了,非常漂亮.:&gt;</p>
<h3 id="实验二-编码器和译码器"><a href="#实验二-编码器和译码器" class="headerlink" title="实验二 编码器和译码器"></a>实验二 编码器和译码器</h3><p>c源文件无需更改<br>verilog文件包含两个模块，数码管模块和编码器模块：</p>
<figure class="highlight v"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*top.v*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> top(x,en,l,h);</span><br><span class="line"><span class="comment">/*接口定义,x是输入,en是使能,l是编码结果,h是数码管输出结果*/</span></span><br><span class="line">  <span class="keyword">input</span>  [<span class="number">7</span>:<span class="number">0</span>]x;</span><br><span class="line">  <span class="keyword">input</span>  en;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>]l;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">6</span>:<span class="number">0</span>]h;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*线路声明,用y存放编码结果,sign存放指示位*/</span></span><br><span class="line">  <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>]y;</span><br><span class="line">  <span class="keyword">wire</span> sign = en &amp; (|x);<span class="comment">//若x至少有一位为1.且使能为1,结果就为1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*每当x或en发生变化时,都会进行译码,如果有使能,结果是x的为1的位的序号,高位优先,如果没有使能,结果为0*/</span></span><br><span class="line">  <span class="keyword">integer</span> i;</span><br><span class="line">  <span class="keyword">always</span> @(x <span class="keyword">or</span> en) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (en) <span class="keyword">begin</span></span><br><span class="line">      y = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span>( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; i = i+<span class="number">1</span>)</span><br><span class="line">          <span class="keyword">if</span>(x[i] == <span class="number">1</span>)  y = i[<span class="number">2</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span>  <span class="keyword">begin</span></span><br><span class="line">      y = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="comment">/*l是编码的总结果,包含符号位和数据位,实例化一个数码管*/</span></span><br><span class="line">  <span class="keyword">assign</span> l = &#123;sign,y&#125;;</span><br><span class="line">  seg seg1(</span><br><span class="line">    <span class="variable">.b</span>(l),</span><br><span class="line">    <span class="variable">.h</span>(h)</span><br><span class="line">  );</span><br></pre></td></tr></table></figure>

<figure class="highlight v"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*seg.v*/</span></span><br><span class="line"><span class="keyword">module</span> seg(</span><br><span class="line">  <span class="comment">/*输入输出定义,输入4位编码值,输出7位数码管的显示控制*/</span></span><br><span class="line">  <span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] b,</span><br><span class="line">  <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">6</span>:<span class="number">0</span>] h</span><br><span class="line">);</span><br><span class="line"><span class="comment">/*每当b发生变化,都会重新更新输出*/</span></span><br><span class="line"><span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line"><span class="comment">/*首先检验指示位,若指示位为0,默认显示为8(共阳极数码管)*/</span></span><br><span class="line">  <span class="keyword">if</span>(b[<span class="number">3</span>] == <span class="number">0</span>)</span><br><span class="line">    h = <span class="number">7&#x27;b0000000</span>;</span><br><span class="line">  <span class="keyword">else</span>  <span class="keyword">begin</span></span><br><span class="line">  <span class="comment">/*若v指示位不为0,则根据数据位进行译码,默认输出为8,*/</span></span><br><span class="line">  	<span class="keyword">case</span>(b[<span class="number">2</span>:<span class="number">0</span>])</span><br><span class="line">      <span class="number">3&#x27;d0</span> : h = ~<span class="number">7&#x27;b0111111</span>;</span><br><span class="line">      <span class="number">3&#x27;d1</span> : h = ~<span class="number">7&#x27;b0000110</span>;</span><br><span class="line">      <span class="number">3&#x27;d2</span> : h = ~<span class="number">7&#x27;b1011011</span>;</span><br><span class="line">      <span class="number">3&#x27;d3</span> : h = ~<span class="number">7&#x27;b1001111</span>;</span><br><span class="line">      <span class="number">3&#x27;d4</span> : h = ~<span class="number">7&#x27;b1100110</span>;</span><br><span class="line">      <span class="number">3&#x27;d5</span> : h = ~<span class="number">7&#x27;b1101101</span>;</span><br><span class="line">      <span class="number">3&#x27;d6</span> : h = ~<span class="number">7&#x27;b1111101</span>;</span><br><span class="line">      <span class="number">3&#x27;d7</span> : h = ~<span class="number">7&#x27;b0000111</span>;</span><br><span class="line">      <span class="comment">//&#x27;d8 : h = ~7&#x27;b1111111;</span></span><br><span class="line">      <span class="comment">//&#x27;d9 : h = ~7&#x27;b1101111;</span></span><br><span class="line">      <span class="keyword">default</span> : h = ~<span class="number">7&#x27;b1111111</span>;</span><br><span class="line">    <span class="keyword">endcase</span></span><br><span class="line">  en</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<p>约束文件的绑定是这样的:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">top=top<span class="comment">//指定top接口名称</span></span><br><span class="line">x (SW7,SW6,SW5,SW4,SW3,SW2,SW1,SW0)<span class="comment">//八个开关作为输入</span></span><br><span class="line">en SW8<span class="comment">//使能</span></span><br><span class="line">l (LD3,LD2,LD1,LD0)<span class="comment">//四个led灯显示编码结果</span></span><br><span class="line">h (SEG0G, SEG0F, SEG0E, SEG0D, SEG0C, SEG0B, SEG0A)<span class="comment">//数码管0输出结果,注意链接顺序要与编码匹配</span></span><br></pre></td></tr></table></figure>

<h3 id="第三章-加法器和ALU"><a href="#第三章-加法器和ALU" class="headerlink" title="第三章 加法器和ALU"></a>第三章 加法器和ALU</h3><p>首先通过约束文件介绍一下整体功能</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">top=top</span><br><span class="line">operand (SW7,SW6,SW5,SW4,SW3,SW2,SW1,SW0)<span class="comment">//八个开关输入操作数</span></span><br><span class="line">button  (BTNC,BTNU,BTND,BTNL,BTNR)<span class="comment">//按钮:上下让指令加减2,左右让指令加减1,上下左右都会让使能归零,中间会让使能取反</span></span><br><span class="line"><span class="comment">//也就是实际使用的时候,每当调整指令,都会看到结果消失,按下中间的按钮结果才会再次出现</span></span><br><span class="line">instr_seg (SEG7G, SEG7F, SEG7E, SEG7D, SEG7C, SEG7B, SEG7A)<span class="comment">//最左端数码管显示指令号</span></span><br><span class="line"><span class="comment">/*为了提升视觉体验,没有用到的数码管全部设成空的*/</span></span><br><span class="line">empty_seg (SEG6G, SEG6F, SEG6E, SEG6D, SEG6C, SEG6B, SEG6A,SEG5G, SEG5F, SEG5E, SEG5D, SEG5C, SEG5B, SEG5A,SEG4G, SEG4F, SEG4E, SEG4D, SEG4C, SEG4B, SEG4A,SEG3G, SEG3F, SEG3E, SEG3D, SEG3C, SEG3B, SEG3A)</span><br><span class="line"><span class="comment">/*四个标识符,对应进位/0/负/溢出*/</span></span><br><span class="line">CF LD3</span><br><span class="line">ZF LD2</span><br><span class="line">SF LD1</span><br><span class="line">OF LD0</span><br><span class="line"><span class="comment">/*右边三个数码管输出结果,如果是负数会显示负号哦~*/</span></span><br><span class="line">value_seg (SEG2G, SEG2F, SEG2E, SEG2D, SEG2C, SEG2B, SEG2A,SEG1G, SEG1F, SEG1E, SEG1D, SEG1C, SEG1B, SEG1A,SEG0G, SEG0F, SEG0E, SEG0D, SEG0C, SEG0B, SEG0A)</span><br><span class="line"><span class="comment">/*左边的几个LED灯显示使能和运算结果的二进制表示,用作调试*/</span></span><br><span class="line">value (LD13,LD12,LD11,LD10)</span><br><span class="line">en LD15</span><br></pre></td></tr></table></figure>
<p>seg模块复用了之前的模块,但是做了些许调整,以显示9,负号和空:</p>
<figure class="highlight v"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*seg.v*/</span></span><br><span class="line">  	<span class="keyword">case</span>(b[<span class="number">3</span>:<span class="number">0</span>])</span><br><span class="line">      ......</span><br><span class="line">      <span class="number">4&#x27;d9</span> : h = ~<span class="number">7&#x27;b1101111</span>;</span><br><span class="line">      <span class="number">4&#x27;d10</span> : h = <span class="number">7&#x27;b0111111</span>;<span class="comment">//负号</span></span><br><span class="line">      <span class="keyword">default</span> : h = <span class="number">7&#x27;b1111111</span>;<span class="comment">//空</span></span><br><span class="line">    <span class="keyword">endcase</span></span><br></pre></td></tr></table></figure>
<p>接下来是alu的主体部分:</p>
<figure class="highlight v"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*top.v*/</span></span><br><span class="line"><span class="keyword">module</span> top(</span><br><span class="line"><span class="comment">/*输入输出声明*/</span></span><br><span class="line">  <span class="keyword">input</span>  [<span class="number">7</span>:<span class="number">0</span>]operand,</span><br><span class="line">  <span class="keyword">input</span>  [<span class="number">4</span>:<span class="number">0</span>]button,</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">6</span>:<span class="number">0</span>]instr_seg,</span><br><span class="line">  <span class="keyword">output</span> <span class="keyword">reg</span> CF,</span><br><span class="line">  <span class="keyword">output</span> <span class="keyword">reg</span> ZF,</span><br><span class="line">  <span class="keyword">output</span> <span class="keyword">reg</span> SF,</span><br><span class="line">  <span class="keyword">output</span> <span class="keyword">reg</span> OF,</span><br><span class="line">  <span class="keyword">output</span> <span class="keyword">reg</span> en,</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">20</span>:<span class="number">0</span>]value_seg,</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">27</span>:<span class="number">0</span>]empty_seg,</span><br><span class="line">  <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>]value);</span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">2</span>:<span class="number">0</span>]instr;</span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>]a;</span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>]b;</span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>]value_num;</span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>]value_sign;</span><br><span class="line"><span class="comment">/*将不需要使用的数码管置空*/</span></span><br><span class="line">  <span class="keyword">assign</span> empty_seg = &#123;<span class="number">28</span>&#123;<span class="number">1&#x27;b1</span>&#125;&#125;;</span><br><span class="line"><span class="comment">/*实例化:指令数码管,负号数码管,结果数码管,按钮控制器*/</span></span><br><span class="line">  seg seg7(</span><br><span class="line">    <span class="variable">.b</span>(&#123;<span class="number">1&#x27;b0</span>,instr&#125;),</span><br><span class="line">    <span class="variable">.h</span>(instr_seg)</span><br><span class="line">  );</span><br><span class="line">  seg seg0(</span><br><span class="line">    <span class="variable">.b</span>(value_num[<span class="number">3</span>:<span class="number">0</span>]),</span><br><span class="line">    <span class="variable">.h</span>(value_seg[<span class="number">6</span>:<span class="number">0</span>])</span><br><span class="line">  );</span><br><span class="line">  seg seg1(</span><br><span class="line">    <span class="variable">.b</span>(value_num[<span class="number">7</span>:<span class="number">4</span>]),</span><br><span class="line">    <span class="variable">.h</span>(value_seg[<span class="number">13</span>:<span class="number">7</span>])</span><br><span class="line">  );</span><br><span class="line">  seg seg2(</span><br><span class="line">    <span class="variable">.b</span>(value_sign[<span class="number">3</span>:<span class="number">0</span>]),</span><br><span class="line">    <span class="variable">.h</span>(value_seg[<span class="number">20</span>:<span class="number">14</span>])</span><br><span class="line">  );</span><br><span class="line">  button button0(</span><br><span class="line">    <span class="variable">.button</span>(button),</span><br><span class="line">    <span class="variable">.instr</span>(instr),</span><br><span class="line">    <span class="variable">.en</span>(en)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="comment">/*开关输入的操作数*/</span></span><br><span class="line">  <span class="keyword">assign</span> &#123;a,b&#125; = operand;</span><br><span class="line"><span class="comment">/*为减法运算进行的取反,这里不能加一,为了防止Tmin的符号判断错误*/</span> </span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>]b_comp = &#123;<span class="number">4</span>&#123;instr[<span class="number">0</span>]&#125;&#125;^b;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*操作数,使能,指令码之一变化,就重新输出结果*/</span></span><br><span class="line">  <span class="keyword">always</span> @(operand <span class="keyword">or</span> en <span class="keyword">or</span> instr) <span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> (en) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">case</span> (instr)</span><br><span class="line">    <span class="comment">/*加减法*/</span></span><br><span class="line">    <span class="number">3&#x27;d0</span>, <span class="number">3&#x27;d1</span>: <span class="keyword">begin</span></span><br><span class="line">    <span class="comment">/*不能把a+b_comp+&#123;1&#x27;b0,instr&#125;直接赋给&#123;CF,value&#125;,否则当b=0时,b_comp+1会错误的进位*/</span></span><br><span class="line">    value =  b_comp + &#123;<span class="number">1&#x27;b0</span>,instr&#125;;</span><br><span class="line">    &#123;CF,value&#125; = value +a;</span><br><span class="line">    <span class="comment">/*计算溢出:操作数符号相同,结果与操作数符号不同*/</span></span><br><span class="line">    OF = (a[<span class="number">3</span>] == b_comp[<span class="number">3</span>]) &amp;&amp; (value[<span class="number">3</span>] != a[<span class="number">3</span>]);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">/*逻辑运算*/</span></span><br><span class="line">    <span class="number">3&#x27;d2</span> : <span class="keyword">begin</span>  value = ~a;    &#123;CF,  OF&#125; =<span class="number">2&#x27;d0</span>;  <span class="keyword">end</span></span><br><span class="line">    <span class="number">3&#x27;d3</span> : <span class="keyword">begin</span>  value = a &amp; b; &#123;CF,  OF&#125; =<span class="number">2&#x27;d0</span>;  <span class="keyword">end</span></span><br><span class="line">    <span class="number">3&#x27;d4</span> : <span class="keyword">begin</span>  value = a | b; &#123;CF,  OF&#125; =<span class="number">2&#x27;d0</span>;  <span class="keyword">end</span></span><br><span class="line">    <span class="number">3&#x27;d5</span> : <span class="keyword">begin</span>  value = a ^ b; &#123;CF,  OF&#125; =<span class="number">2&#x27;d0</span>;  <span class="keyword">end</span></span><br><span class="line">    <span class="comment">/*关系运算*/</span></span><br><span class="line">    <span class="number">3&#x27;d6</span> : <span class="keyword">begin</span>  value = &#123;<span class="number">3&#x27;b000</span>,a&lt;b&#125;; &#123;CF, OF&#125; =<span class="number">2&#x27;d0</span>; <span class="keyword">end</span></span><br><span class="line">    <span class="number">3&#x27;d7</span> : <span class="keyword">begin</span>  value = &#123;<span class="number">3&#x27;b000</span>,a==b&#125;;&#123;CF, OF&#125; =<span class="number">2&#x27;d0</span>; <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endcase</span></span><br><span class="line">    ZF = value==<span class="number">0</span>;</span><br><span class="line">    SF = value[<span class="number">3</span>] == <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line"><span class="comment">/*若使能为0,所有结果都为0*/</span></span><br><span class="line">    value = <span class="number">0</span>;</span><br><span class="line">    &#123;CF, ZF, SF, OF&#125; =<span class="number">4&#x27;d0</span>;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">/*value_show是value的绝对值*/</span></span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>]value_show;</span><br><span class="line">  <span class="keyword">assign</span> value_show = SF ? (~value+<span class="number">1</span>) : value;</span><br><span class="line">  </span><br><span class="line"><span class="comment">/*value_num高四位是十位数,低四位是个位数,value_sign是负号或空*/</span></span><br><span class="line">  <span class="keyword">assign</span> value_num[<span class="number">7</span>:<span class="number">4</span>] = value_show / <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">assign</span> value_num[<span class="number">3</span>:<span class="number">0</span>] = value_show % <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">assign</span> value_sign[<span class="number">3</span>:<span class="number">0</span>] = <span class="number">4&#x27;d11</span> - &#123;<span class="number">3&#x27;b000</span>, (value[<span class="number">3</span>] == <span class="number">1</span>)&#125;;<span class="comment">//为10,当为负.为11,当为正</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>接下来是按钮控制模块,相当于有多个触发条件和触发行为的触发器:</p>
<figure class="highlight v"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> button(</span><br><span class="line"><span class="comment">/*输入输出声明:输入中上下左右四个按钮的信号,输出指令编码和使能*/</span></span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">4</span>:<span class="number">0</span>]button,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>]instr,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> en);</span><br><span class="line"><span class="comment">/*所有的五个按钮的上升沿都会触发指令或使能的改变*/</span></span><br><span class="line"> <span class="keyword">always</span> @(<span class="keyword">posedge</span> button[<span class="number">3</span>]<span class="keyword">or</span> <span class="keyword">posedge</span> button[<span class="number">2</span>] <span class="keyword">or</span> <span class="keyword">posedge</span> button[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">or</span> <span class="keyword">posedge</span> button[<span class="number">0</span>] <span class="keyword">or</span> <span class="keyword">posedge</span> button[<span class="number">4</span>]) <span class="keyword">begin</span></span><br><span class="line"><span class="comment">/*按一下中间的按钮可以让使能取反*/</span></span><br><span class="line">     <span class="keyword">if</span>(button[<span class="number">4</span>]) <span class="keyword">begin</span></span><br><span class="line">         en &lt;= ~en;</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">     <span class="comment">/*上:指令+2;下:指令-2;左:指令+1;右:指令-1;这四个按钮都会让使能归零*/</span></span><br><span class="line">        <span class="keyword">case</span>(button)</span><br><span class="line">        <span class="number">5&#x27;b01000</span>:  <span class="keyword">begin</span> instr &lt;= instr+<span class="number">2</span>; en &lt;= <span class="number">0</span>;<span class="keyword">end</span></span><br><span class="line">        <span class="number">5&#x27;b00100</span>:  <span class="keyword">begin</span> instr &lt;= instr-<span class="number">2</span>; en &lt;= <span class="number">0</span>;<span class="keyword">end</span></span><br><span class="line">        <span class="number">5&#x27;b00010</span>:  <span class="keyword">begin</span> instr &lt;= instr+<span class="number">1</span>; en &lt;= <span class="number">0</span>;<span class="keyword">end</span></span><br><span class="line">        <span class="number">5&#x27;b00001</span>:  <span class="keyword">begin</span> instr &lt;= instr-<span class="number">1</span>; en &lt;= <span class="number">0</span>;<span class="keyword">end</span></span><br><span class="line">        <span class="keyword">default</span>:   en &lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span> </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>总体而言,按中间的按钮会执行当前指令的运算,然后可以调节开关,观察结果.如果按上下左右四个按钮,会看到指令码变化,结果消失,需要重新按一次中间的按钮才会出现结果(就好像计算器的”等于”键)</p>
<h3 id="实验五-寄存器组以及存储器"><a href="#实验五-寄存器组以及存储器" class="headerlink" title="实验五 寄存器组以及存储器"></a>实验五 寄存器组以及存储器</h3><ul>
<li><p>分析三个输出端口的存储器实例  </p>
<figure class="highlight v"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)</span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">if</span> (we)</span><br><span class="line">          ram[inaddr] &lt;= din;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line"><span class="comment">/*dout0在不进行写入的上升沿读取*/</span></span><br><span class="line">          dout0 &lt;= ram[outaddr];</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">always</span> @(<span class="keyword">negedge</span> clk)</span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line"><span class="comment">/*dout1在没有写使能的下降沿读取*/</span></span><br><span class="line">      <span class="keyword">if</span> (!we)</span><br><span class="line">          dout1 &lt;= ram[outaddr];</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*dout2永远直接读取输出信号*/</span></span><br><span class="line">  <span class="keyword">assign</span>  dout2 = ram[outaddr];</span><br></pre></td></tr></table></figure>
<h2 id="完成PA1第一阶段"><a href="#完成PA1第一阶段" class="headerlink" title="完成PA1第一阶段"></a>完成PA1第一阶段</h2><h3 id="1-开天辟地的篇章"><a href="#1-开天辟地的篇章" class="headerlink" title="1. 开天辟地的篇章"></a>1. 开天辟地的篇章</h3></li>
<li><p>尝试理解计算机如何计算</p>
<p>  取指执行,以跳转实现控制流,以内存和寄存器实现变量</p>
</li>
<li><p>从状态机视角理解程序运行</p>
</li>
</ul>
<p>先把程序写出来:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// PC: instruction    | // label: statement</span><br><span class="line"><span class="number">0</span>: mov  r1, <span class="number">0</span>         |  pc0: r1 = <span class="number">0</span>;</span><br><span class="line"><span class="number">1</span>: mov  r2, <span class="number">0</span>         |  pc1: r2 = <span class="number">0</span>;</span><br><span class="line"><span class="number">2</span>: addi r2, r2, <span class="number">1</span>     |  pc2: r2 = r2 + <span class="number">1</span>;</span><br><span class="line"><span class="number">3</span>: add  r1, r1, r2    |  pc3: r1 = r1 + r2;</span><br><span class="line"><span class="number">4</span>: blt  r2, <span class="number">100</span>, <span class="number">2</span>    |  pc4: <span class="keyword">if</span>(r2&lt;<span class="number">100</span>) goto <span class="number">2</span></span><br><span class="line"><span class="number">5</span>: jmp <span class="number">5</span>              |  pc5: goto pc5;</span><br></pre></td></tr></table></figure>
<p>然后是开头:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">0</span>, x, x) -&gt; (<span class="number">1</span>, <span class="number">0</span>, x) -&gt; (<span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>) -&gt; (<span class="number">3</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>接下来的状态是:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>) -&gt; (<span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>) -&gt; (<span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>) -&gt; (<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>) -&gt; (<span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>) -&gt; (<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>) -&gt; (<span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>)-&gt;...</span><br><span class="line">-&gt;(<span class="number">4</span>, <span class="number">4851</span>, <span class="number">98</span>) -&gt; (<span class="number">2</span>, <span class="number">4851</span>, <span class="number">98</span>) -&gt; (<span class="number">3</span>, <span class="number">4851</span>, <span class="number">99</span>) -&gt; (<span class="number">4</span>, <span class="number">4950</span>, <span class="number">99</span>) -&gt; (<span class="number">2</span>, <span class="number">4950</span>, <span class="number">99</span>) -&gt; (<span class="number">3</span>, <span class="number">4950</span>, <span class="number">100</span>) -&gt; (<span class="number">4</span>, <span class="number">5050</span>, <span class="number">100</span>) -&gt; (<span class="number">5</span>, <span class="number">5050</span>, <span class="number">100</span>) &lt;-&gt; (<span class="number">5</span>, <span class="number">5050</span>, <span class="number">100</span>)</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="辉夜"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">辉夜</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">31</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">辉夜</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
